---
layout: post
title: Complementing MongoDB with Full Text Search from Solr
date: 2013-11-18
comments: false
---

<h1>{{ page.title }}</h1>
<div class='post'>
<h3>Introduction</h3>MongoDB is a great database, but one area that I've noticed it's been deficient in is full text search. Thankfully, there are some great tools around that we can employ to compliment Mongo and give it this functionality.<br /><br />Today's post will be a walk through to getting Solr &amp; mongo-connector installed and configured on Debian Wheezy.<br /><br /><h3>Get the software</h3>First up, install Solr on tomcat with the tomcat administration tools<br /><br /><pre class="brush: shell">$ sudo apt-get install solr-tomcat tomcat6-admin</pre><br />Straight after this has installed, you'll need to configure a user to access these applications. Use your favorite text editor and open /etc/tomcat6/tomcat-users.xml. This file (like all of the configuration files) is really well commented. The steps I took here were:<br /><ul><li>Added a "role" node for "manager-gui"</li><li>Added "manager-gui" as a role to the "tomcat" user</li></ul>In the end, you should have something sort-of like this:<br /><br /><pre class="brush: plain">&lt;role rolename="tomcat"/&gt;<br />&lt;role rolename="manager-gui"/&gt;<br />&lt;user username="tomcat" password="tomcat" roles="tomcat,manager-gui"/&gt; <br /></pre><br />Now that you've finished configuring all of the user access, restart tomcat.<br /><br /><pre class="brush: shell">$ sudo service tomcat restart</pre><br />You can now check that tomcat is up and running by pointing your web browser at <a href="http://localhost:8080/">http://localhost:8080/</a>. When you click on the manager-app link, you'll be prompted for a username and password. As defined by the user configuration above, the username is "tomcat" and the password is "tomcat". Have a click around, you should also see Solr installed in there also. <br /><br /><h3>Solr Schema</h3>Now it's time we tell Solr exactly what we want to index. Remember, it's going to be a client to our mongo database - so any interesting fields that you want indexed will need to be mentioned here.<br /><br />Solr's schema file is found at /etc/solr/conf/schema.xml. Everyone's requirements are way to broad for me to go into depth here on what to do, but it would be a good time to look up the documentation and learn about how you want your data attributed: <a href="http://wiki.apache.org/solr/SchemaXml">http://wiki.apache.org/solr/SchemaXml</a>.<br /><br /><h3>Connecting to Mongo</h3>Next, we're going to connect Solr to mongo using <a href="http://blog.mongodb.org/post/29127828146/introducing-mongo-connector">mongo-connect</a>. There's some more software that's needed to be installed here. mongo-connect is a python package that listens to mongo's oplog for "interesting" things, and then stores them away into Solr for fast searching later.<br /><br />We will need pip.<br /><br /><pre class="brush: shell">$ sudo apt-get install python-dev python-pip</pre><br />We're also going to need some xml dependencies that mongo-connect relies on.<br /><br /><pre class="brush: shell">$ sudo apt-get install libxml2 libxml2-dev libxslt-dev</pre><br />Install the lxml &amp; cssselect python packages<br /><br /><pre class="brush: shell">$ sudo pip install lxml cssselect</pre><br />Finally, we install the mongo-connector <br /><br /><pre class="brush: shell">$ sudo pip install mongo-connector</pre><br /><h3>Running the connector</h3>Now that you're all installed, it's time to start indexing some data. Again, everyone's requirements are going to be quite different - so it's a good time to go out and take a look at the <a href="https://github.com/10gen-labs/mongo-connector">mongo-connector github page</a> to understand the full usage of the command.<br /><br />A typical execution of the command would look like this:<br /><br /><pre class="brush: shell">$ mongo-connector -m localhost:27217 -t http://localhost:8080/solr -o oplog_progress.txt -n alpha.foo,test.test -u _id -k auth.txt -a admin -d ./doc_managers/solr_doc_manager.py</pre><br />From here, mongo-connector listens to changes and stores them away in Solr so that your full text search facility has them available.<br /><br />That's it for Solr &amp; MongoDB.</div>
<h2>Comments</h2>
<div class='comments'>
</div>
