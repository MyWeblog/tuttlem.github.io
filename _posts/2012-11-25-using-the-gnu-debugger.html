---
layout: post
title: Using the GNU Debugger
date: 2012-11-25
comments: false
---

<h1>{{ page.title }}</h1>
<div class='post'>
Bundled with the GNU toolset is a full featured debugger in GDB. This blog post aims to be a cheatsheet to get yourself around this tool quickly.<br /><br /><h3>The example program</h3><div><br /><pre class="brush:c;">int main(int argc, char *argv[]) {<br />  /* some local variables */<br />  int x = 1, y = 2, z = 0;<br />  <br />  /* something that will go bad */<br />  int ans = x / z;<br /><br />  return 0;<br />}<br /></pre></div><h3>Compile your code with debug info</h3><div>You need to use the "-g" switch with GCC in order to compile debug symbols. This helps the feedback that GDB will give you a great deal.</div><div><br /><pre class="brush:shell;">gcc -g test.c -o test<br /></pre><h3>Loading your program into the debugger</h3></div><div>So, in our example above the name of our executable would be "test". So, we just tell gdb to load test by passing it in.</div><div><br /><pre class="brush:shell;">gdb test<br /></pre><br />You can even start gdb with a text user interface, so I've just discovered.<br /><br /><pre class="brush:shell;" style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;">gdb test -tui</pre><br />It looks like this - not bad, eh?<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-6Zx3N1_lUdg/ULHS7XhkRaI/AAAAAAAAAhg/oS9iA9-Jl1c/s1600/Screenshot+-+251112+-+18:11:48.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="276" src="http://2.bp.blogspot.com/-6Zx3N1_lUdg/ULHS7XhkRaI/AAAAAAAAAhg/oS9iA9-Jl1c/s400/Screenshot+-+251112+-+18:11:48.png" width="400" /></a></div><br /><br /></div>Now we instruct gdb that we'd like to run the application<br /><br /><pre class="brush:plain;">(gdb) run<br />Starting program: /home/michael/Development/gdb-tute/test <br /><br />Program received signal SIGFPE, Arithmetic exception.<br />0x00000000004004c3 in main (argc=1, argv=0x7fffffffe4d8) at test.c:9<br />9    ans = x / z;<br /></pre><br />So you can see here that dividing by zero wasn't the best career move for this program. But It nicely let us know that there was an arithmetic exception on line 9!<br /><br /><h3>Examining data</h3>To get just the call stack information, we issue the "backtrace" instruction<br /><br /><pre class="brush:plain;">(gdb) backtrace<br />#0  0x00000000004004c3 in main (argc=1, argv=0x7fffffffe4d8) at test.c:9<br /></pre><br />Examining data with print. We can view the value of variables by passing them to the print statement.<br /><br /><pre class="brush:plain;">(gdb) print x<br />$1 = 1<br />(gdb) print y<br />$2 = 2<br />(gdb) print z<br />$3 = 0<br /></pre><br />Print also supports printf style specifiers. Examining data at an address. We can view the value of data at a memory location by using the "x" command.<br /><br /><pre class="brush:plain;">(gdb) print &amp;z<br />$4 = (int *) 0x7fffffffe3e8<br />(gdb) x 0x7fffffffe3e8<br />0x7fffffffe3e8: 0x00000000</pre><pre class="brush:plain;"></pre><br />Setting variables while attached is done with "set". We can stop the error in the program at runtime using this mixed with a breakpoint.<br /><br /><pre class="brush:plain;">Breakpoint 1, main (argc=1, argv=0x7fffffffe4d8) at test.c:6<br />6    int x = 1, y = 2, z = 0;<br />(gdb) next<br />7    int ans = 0;<br />(gdb) set (z = 5)<br />(gdb) print z<br />$1 = 5</pre><h3>Working with breakpoints</h3>To set a breakpoint in gdb, just pass the name of what you'd like to break on to the "break" command.<br /><br /><pre class="brush:plain;">(gdb) break main<br />Breakpoint 1 at 0x40049f: file test.c, line 6.<br />(gdb) run<br />Starting program: /home/michael/Development/gdb-tute/test <br /><br />Breakpoint 1, main (argc=1, argv=0x7fffffffe4d8) at test.c:6<br />6    int x = 1, y = 2, z = 0;<br /></pre><br />You can set a breakpoint at a specific source code line number:<br /><br /><pre class="brush:plain;">(gdb) break 7<br />Breakpoint 1 at 0x4004b4: file test.c, line 7.<br /></pre><br />Finally, you can make a breakpoint using a combination of source code file name and line location:<br /><br /><pre class="brush:plain;">(gdb) break test.c:7<br />Breakpoint 3 at 0x4004b4: file test.c, line 7.<br /></pre><br />View your existing breakpoints with "info breakpoints"<br /><br /><pre class="brush:plain;">(gdb) info breakpoints<br />Num     Type           Disp Enb Address            What<br />3       breakpoint     keep y   0x00000000004004b4 in main at test.c:7<br /></pre><br />You can clear any set breakpoint with "clear".<br /><br /><pre class="brush:plain;">(gdb) clear main<br />Deleted breakpoint 1<br /></pre><br />You can step into code by issuing the step command  <br /><pre class="brush:shell;">(gdb) step<br />7    int ans = 0;<br />(gdb) <br />9    ans = x / z;<br />(gdb) <br /></pre><pre class="brush:shell;">Program received signal SIGFPE, Arithmetic exception.<br />0x00000000004004c3 in main (argc=1, argv=0x7fffffffe4d8) at test.c:9<br />9    ans = x / z;<br /></pre><br />You step over code by issuing "next". Its usage is the same as "step".<br /><br />That's all for now. As I come across other useful bits from GDB, I'll certainly post them here. The items above have been lifesavers for me from time to time<br /><br /></div>
<h2>Comments</h2>
<div class='comments'>
</div>
