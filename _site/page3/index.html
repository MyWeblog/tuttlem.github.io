<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Cogs and Levers &middot; A blog full of technical stuff
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>A place for thoughts, ideas, tutorials and bookmarks. My brain can only hold so much, you know.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    

    <a class="sidebar-nav-item" href="https://github.com/tuttlem/tuttlem.github.io">GitHub</a>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2014. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <label for="sidebar-checkbox" class="sidebar-toggle"></label>

          <h3 class="masthead-title">
            <a href="/" title="Home">Cogs and Levers</a>
            <small>A blog full of technical stuff</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/02/06/making-sys-v-init-scripts-for-debian/">
        Making Sys-V Init Scripts for Debian
      </a>
    </h1>

    <span class="post-date">06 Feb 2014</span>

    <h3 id="introduction">Introduction</h3>

<p>Sometimes it&#39;s necessary to run programs (applications or daemons) in the background at different stages of a machine&#39;s up time. The most common use case of which centralises around starting something at boot and stopping something at shutdown.</p>

<p>In today&#39;s post, I&#39;ll be doing a write up on preparing init scripts for Sys-V style systems.</p>

<h3 id="how-it-works">How it works</h3>

<p>Debian&#39;s Sys-V style init system relies on the scripts under <code>/etc/init.d</code> to instruct the operating system on how to start or stop particular programs. A header that sits at the top of these scripts informs the init system under what conditions this script should start and stop.</p>

<p>Here&#39;s an example of this header from an excerpt taken from <code>/etc/init.d/README</code></p>

<p>All <code>init.d</code> scripts are expected to have a LSB style header documenting
dependencies and default runlevel settings.  The header look like this
(not all fields are required):</p>

<div class="highlight"><pre><code class="text">### BEGIN INIT INFO
# Provides:          skeleton
# Required-Start:    $remote_fs $syslog
# Required-Stop:     $remote_fs $syslog
# Should-Start:      $portmap
# Should-Stop:       $portmap
# X-Start-Before:    nis
# X-Stop-After:      nis
# Default-Start:     2 3 4 5
# Default-Stop:      0 1 6
# X-Interactive:     true
# Short-Description: Example initscript
# Description:       This file should be used to construct scripts to be
#                    placed in /etc/init.d.
### END INIT INFO</code></pre></div>

<p>The insserv man page will take you further in-depth as to what each of these means for your init script.</p>

<p>A full example of an init script is given on the Debian administration website here. It doesn&#39;t use the header above - which is acceptable as these fields aren&#39;t required by the script.</p>

<div class="highlight"><pre><code class="bash"><span class="c">#! /bin/sh</span>
<span class="c"># /etc/init.d/blah</span>
<span class="c">#</span>

<span class="c"># Some things that run always</span>
touch /var/lock/blah

<span class="c"># Carry out specific functions when asked to by the system</span>
<span class="k">case</span> <span class="s2">&quot;$1&quot;</span> in
  start<span class="o">)</span>
    <span class="nb">echo</span> <span class="s2">&quot;Starting script blah &quot;</span>
    <span class="nb">echo</span> <span class="s2">&quot;Could do more here&quot;</span>
    <span class="p">;;</span>
  stop<span class="o">)</span>
    <span class="nb">echo</span> <span class="s2">&quot;Stopping script blah&quot;</span>
    <span class="nb">echo</span> <span class="s2">&quot;Could do more here&quot;</span>
    <span class="p">;;</span>
  *<span class="o">)</span>
    <span class="nb">echo</span> <span class="s2">&quot;Usage: /etc/init.d/blah {start|stop}&quot;</span>
    <span class="nb">exit </span>1
    <span class="p">;;</span>
<span class="k">esac</span>

<span class="nb">exit </span>0</code></pre></div>

<p>Putting this script into a text file (into your home directory) and applying execute permissions on the file, allows you to test it at the console. I&#39;ve put this script into a file called &quot;blah&quot;.</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>chmod 755 blah

<span class="nv">$ </span>./blah
Usage: /etc/init.d/blah <span class="o">{</span>start<span class="p">|</span>stop<span class="o">}</span>

<span class="nv">$ </span>./blah start
Starting script blah
Could <span class="k">do </span>more here

<span class="nv">$ </span>./blah stop
Stopping script blah
Could <span class="k">do </span>more here</code></pre></div>

<p>The script implements a &quot;start&quot; and &quot;stop&quot; instruction.</p>

<h3 id="installation">Installation</h3>

<p>Now that you&#39;ve developed your script and are happy with its operation (after testing it at the console), you can install it on your system.</p>

<p>The first step is to copy your script (in this case &quot;blah&quot;) up into <code>/etc/init.d/</code>. This makes it available to the init system to use. It won&#39;t actually use it though until you establish some symlinks between the script and the runlevel script sets.</p>

<p>You can check that it&#39;s available to your system using the &quot;service&quot; command, like so:</p>

<div class="highlight"><pre><code class="text">$ sudo service --status-all
 [ + ]  acpid
 [ + ]  atd
 [ ? ]  blah
 [ - ]  bootlogs
 [ ? ]  bootmisc.sh
 . . .
 . . .
 . . .
 . . .</code></pre></div>

<p>You can see that &quot;blah&quot; is being registered here as an init script and as such can also be started and stopped using the &quot;service&quot; command:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>sudo service blah start
Starting script blah
Could <span class="k">do </span>more here

<span class="nv">$ </span>sudo service blah stop
Stopping script blah
Could <span class="k">do </span>more here</code></pre></div>

<p>Now we&#39;ll attach this init script to the startup and shut down of the computer. update-rc.d will help with this process. You can get the script installed with the following command:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>sudo update-rc.d blah defaults</code></pre></div>

<p>If you no longer want the script to execute on your system, you can remove it from the script sets with the following command:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>update-rc.d -f blah remove</code></pre></div>

<p>After removing it, you&#39;ll still have your script in <code>/etc/init.d/</code>, just in case you want to set it up again.</p>

<p>That&#39;s it for today. </p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/02/04/textfiles-com/">
        Textfiles.com
      </a>
    </h1>

    <span class="post-date">04 Feb 2014</span>

    <p>I had to bookmark this site here. I&#39;ve just burnt the past 2 hours looking through it, fondly remembering the 90&#39;s.</p>

<p><a href="http://www.textfiles.com/programming/">http://www.textfiles.com/programming/</a></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/02/03/setting-up-bochs/">
        Setting up Bochs
      </a>
    </h1>

    <span class="post-date">03 Feb 2014</span>

    <h3 id="introduction">Introduction</h3>

<p>Today&#39;s post is just a short one on the installation of the virtual machine Bochs within a Debian environment.</p>

<h3 id="procedure">Procedure</h3>

<div class="highlight"><pre><code class="bash"><span class="c"># Install Bochs using your package manager</span>
sudo apt-get install bochs

<span class="c"># Install the X11 and sdl plugin for Bochs</span>
sudo apt-get install bochs-x bochs-sdl</code></pre></div>

<p>Finally, make sure that your machines are using <code>SDL</code> as the display library by adding this line to your <code>.bochsrc</code></p>

<div class="highlight"><pre><code class="text">files:display_library: sdl</code></pre></div>

<p>That&#39;s it for today.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/01/30/project-setup-with-maven-at-the-command-line/">
        Project setup with Maven at the Command Line
      </a>
    </h1>

    <span class="post-date">30 Jan 2014</span>

    <h3 id="introduction">Introduction</h3>

<p>A few utilities exist to manage your build, dependencies, test running for Java projects. One that I&#39;ve seen that is quite intuitive (once you wrap your head around the xml structure) is <a href="http://maven.apache.org/">Maven</a>. According to the website, Maven is a &quot;software project management and comprehension tool&quot;.</p>

<p>The main benefit I&#39;ve seen already is how the developer&#39;s work-cycle is managed using the &quot;POM&quot; (project object model). The POM is just an XML file that accompanies your project to describe to Maven what your requirements are to build, test &amp; package your software unit.</p>

<p>An excellent, short post can be found on the Maven website called <a href="http://maven.apache.org/guides/getting-started/maven-in-five-minutes.html">&quot;Maven in 5 minutes&quot;</a>.</p>

<p>Today&#39;s post will focus on Maven installation and getting a &quot;Hello, world&quot; project running.</p>

<h3 id="installation">Installation</h3>

<p>I&#39;m on a Debian-flavored Linux distribution, so you may need to translate slightly between package managers. To get Maven installed, issue the following command at the prompt:</p>

<div class="highlight"><pre><code class="bash">sudo apt-get install maven</code></pre></div>

<p>Check that everything has installed correctly with the following command:</p>

<div class="highlight"><pre><code class="bash">mvn --version</code></pre></div>

<p>You should see some output not unlike what I&#39;ve got here:</p>

<div class="highlight"><pre><code class="text">Apache Maven 3.0.4
Maven home: /usr/share/maven
Java version: 1.7.0_25, vendor: Oracle Corporation
Java home: /usr/lib/jvm/java-7-openjdk-amd64/jre
Default locale: en_AU, platform encoding: UTF-8
OS name: &quot;linux&quot;, version: &quot;3.2.0-4-amd64&quot;, arch: &quot;amd64&quot;, family: &quot;unix&quot;</code></pre></div>

<p>If you&#39;re seeing output like what I&#39;ve got above - that&#39;s it. You&#39;re installed now.</p>

<h3 id="first-project">First Project</h3>

<p>Getting your first application together is pretty easy. A &quot;quick start&quot; approach is to use the quick start templates to generate a project structure like so:</p>

<div class="highlight"><pre><code class="bash"><span class="nb">cd</span> ~/Source
mvn archetype:generate -DgroupId<span class="o">=</span>org.temp -DartifactId<span class="o">=</span>hello -DarchetypeArtifactId<span class="o">=</span>maven-archetype-quickstart -DinteractiveMode<span class="o">=</span><span class="nb">false</span></code></pre></div>

<p>Maven will then go out and grab all that it needs from the web to get your project setup. It&#39;s now generated a project structure for you (in a directory called &quot;hello&quot;) that looks like this:</p>

<div class="highlight"><pre><code class="text">.
└── src
    ├── main
    │   └── java
    │       └── org
    │           └── temp
    └── test
        └── java
            └── org
                └── temp</code></pre></div>

<p>Editing the file that they put into the source folder for you (at src/main/java/org/temp/App.java), you can see that your job is already done:</p>

<div class="highlight"><pre><code class="java"><span class="kn">package</span> <span class="n">org</span><span class="o">.</span><span class="na">temp</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * Hello world!</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span> <span class="n">String</span><span class="o">[]</span> <span class="n">args</span> <span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span> <span class="s">&quot;Hello World!&quot;</span> <span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p>Build it and give it a run!</p>

<div class="highlight"><pre><code class="bash">mvn compile
mvn <span class="nb">exec</span>:java -Dexec.mainClass<span class="o">=</span><span class="s2">&quot;org.temp.App&quot;</span></code></pre></div>

<p>You should see some output like this:</p>

<div class="highlight"><pre><code class="text">[INFO] Scanning for projects...
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] Building hello 1.0-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO]
[INFO] &gt;&gt;&gt; exec-maven-plugin:1.2.1:java (default-cli) @ hello &gt;&gt;&gt;
[INFO]
[INFO] &lt;&lt;&lt; exec-maven-plugin:1.2.1:java (default-cli) @ hello &lt;&lt;&lt;
[INFO]
[INFO] --- exec-maven-plugin:1.2.1:java (default-cli) @ hello ---
Hello World!
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 2.331s
[INFO] Finished at: Thu Jan 30 12:46:28 EST 2014
[INFO] Final Memory: 7M/30M
[INFO] ------------------------------------------------------------------------</code></pre></div>

<p>Most important line there is &quot;Hello World!&quot;. </p>

<p>There is so much more that you can do with Maven for your projects. Check out the documentation - that&#39;s it for today.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/01/30/create-a-mapreduce-job-using-java-and-maven/">
        Create a MapReduce Job using Java and Maven
      </a>
    </h1>

    <span class="post-date">30 Jan 2014</span>

    <h3 id="introduction">Introduction</h3>

<p>In a <a href="/2014/01/30/create-a-mapreduce-job-using-java-and-maven/">previous post</a>, I walked through the very basic operations of getting a Maven project up and running so that you can start writing Java applications using this managed environment.</p>

<p>In today&#39;s post, I&#39;ll walk through the modifications required to your POM to get a MapReduce job running on Hadoop 2.2.0.</p>

<p>If you don&#39;t have Maven installed yet, do that . . . maybe even have a bit of a read up on what it is, how it helps and how you can use it. Of course you&#39;ll also need your Hadoop environment up and running!
Project Setup
First thing you&#39;ll need to do, is to create a project structure using Maven in your workspace/source folder. I do this with the following command:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>mvn archetype:generate -DarchetypeGroupId<span class="o">=</span>org.apache.maven.archetypes -DgroupId<span class="o">=</span>com.test.wordcount -DartifactId<span class="o">=</span>wordcount</code></pre></div>

<p>As it runs, this command will ask you a few questions on the details of your project. For all of the questions, I&#39;ve found selecting the default value was sufficient. So . . . enter enter enter !</p>

<p>Once the process is complete, you&#39;ll have a project folder created for you. In this example, my project folder is &quot;wordcount&quot; (you can probably see where this tutorial is now headed). Changing into this folder and having a look at the directory tree, you should see the following:</p>

<div class="highlight"><pre><code class="text">~/src/wordcount$ tree
.
├── pom.xml
└── src
    ├── main
    │   └── java
    │       └── com
    │           └── test
    │               └── wordcount
    │                   └── App.java
    └── test
        └── java
            └── com
                └── test
                    └── wordcount
                        └── AppTest.java

11 directories, 3 files</code></pre></div>

<p>Now it&#39;s time to change the project environment so that it&#39;ll suit our Hadoop application target.</p>

<h3 id="adjusting-the-pom-for-hadoop">Adjusting the POM for Hadoop</h3>

<p>There&#39;s only a few minor alterations that are required here. The first one is, referencing the Hadoop libraries so that they are available to you to program against. We also specify the type of packaging for the application. Lastly, changing the language version (to something higher than what&#39;s specified as default).</p>

<p>Open up &quot;pom.xml&quot; in your editor of choice and add the following lines into the &quot;dependencies&quot; node.</p>

<div class="highlight"><pre><code class="xml"><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupid&gt;</span>org.apache.hadoop<span class="nt">&lt;/groupid&gt;</span>
  <span class="nt">&lt;artifactid&gt;</span>hadoop-client<span class="nt">&lt;/artifactid&gt;</span>
  <span class="nt">&lt;version&gt;</span>2.2.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></div>

<p>This tells the project that we need the &quot;hadoop-client&quot; library (version 2.2.0).</p>

<p>We&#39;re now going to tell Maven to make us an executable JAR. Unfortunately, here&#39;s where the post is slightly pre-emptive upon itself. In order to tell Maven that we want an executable JAR, we need to tell it what class is holding our &quot;main&quot; function. . . we haven&#39;t written any code yet - but we will!</p>

<p>Create a &quot;build&quot; node and within that node create a &quot;plugins&quot; node and add the following to it:</p>

<div class="highlight"><pre><code class="xml"><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>maven-jar-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;archive&gt;</span>
      <span class="nt">&lt;manifest&gt;</span>
        <span class="nt">&lt;addClasspath&gt;</span>true<span class="nt">&lt;/addClasspath&gt;</span>
        <span class="nt">&lt;mainClass&gt;</span>com.test.wordcount.WordCount<span class="nt">&lt;/mainClass&gt;</span>
      <span class="nt">&lt;/manifest&gt;</span>
    <span class="nt">&lt;/archive&gt;</span>
  <span class="nt">&lt;/configuration&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre></div>

<p>More on the <a href="http://maven.apache.org/plugins/maven-jar-plugin/">maven-jar-plugin</a> plugin can be found on the Maven website, but this block builds an executable JAR for us.</p>

<p>Add this next plugin to use Java 1.7 for compilation:</p>

<div class="highlight"><pre><code class="xml"><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;source&gt;</span>1.7<span class="nt">&lt;/source&gt;</span>
    <span class="nt">&lt;target&gt;</span>1.7<span class="nt">&lt;/target&gt;</span>
  <span class="nt">&lt;/configuration&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre></div>

<p>That&#39;s all that should be needed now to perform compilation and packaging of our Hadoop application.</p>

<h3 id="the-job">The Job</h3>

<p>I&#39;ll leave writing Hadoop Jobs to another post, but we still need some code to make sure our project is working (for today).</p>

<p>All I have done for today, is taken the WordCount code that&#39;s on the Hadoop Wiki here <a href="http://wiki.apache.org/hadoop/WordCount">http://wiki.apache.org/hadoop/WordCount</a>, changed the package name to align with what I created my project as <code>com.test.wordcount</code> and saved it into <code>src/main/java/com/test/wordcount/WordCount.java</code></p>

<p>I removed the template provided <code>App.java</code> that was in this folder. I did make one minor patch to this code also. Here&#39;s my full listing that I&#39;ve used for reference anyway.</p>

<div class="highlight"><pre><code class="java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">test</span><span class="o">.</span><span class="na">wordcount</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.hadoop.fs.Path</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.hadoop.conf.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.hadoop.io.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.hadoop.mapreduce.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.hadoop.mapreduce.lib.input.FileInputFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.hadoop.mapreduce.lib.input.TextInputFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.hadoop.mapreduce.lib.output.FileOutputFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.hadoop.mapreduce.lib.output.TextOutputFormat</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WordCount</span> <span class="o">{</span>

   <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Map</span> <span class="kd">extends</span> <span class="n">Mapper</span><span class="o">&lt;</span><span class="n">LongWritable</span><span class="o">,</span> <span class="n">Text</span><span class="o">,</span> <span class="n">Text</span><span class="o">,</span> <span class="n">IntWritable</span><span class="o">&gt;</span> <span class="o">{</span>
      <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">IntWritable</span> <span class="n">one</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IntWritable</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
      <span class="kd">private</span> <span class="n">Text</span> <span class="n">word</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Text</span><span class="o">();</span>

      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">map</span><span class="o">(</span><span class="n">LongWritable</span> <span class="n">key</span><span class="o">,</span> <span class="n">Text</span> <span class="n">value</span><span class="o">,</span> <span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">InterruptedException</span> <span class="o">{</span>
         <span class="n">String</span> <span class="n">line</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
         <span class="n">StringTokenizer</span> <span class="n">tokenizer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringTokenizer</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
         <span class="k">while</span> <span class="o">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="na">hasMoreTokens</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">word</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="na">nextToken</span><span class="o">());</span>
            <span class="n">context</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">word</span><span class="o">,</span> <span class="n">one</span><span class="o">);</span>
         <span class="o">}</span>
      <span class="o">}</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Reduce</span> <span class="kd">extends</span> <span class="n">Reducer</span><span class="o">&lt;</span><span class="n">Text</span><span class="o">,</span> <span class="n">IntWritable</span><span class="o">,</span> <span class="n">Text</span><span class="o">,</span> <span class="n">IntWritable</span><span class="o">&gt;</span> <span class="o">{</span>

      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">reduce</span><span class="o">(</span><span class="n">Text</span> <span class="n">key</span><span class="o">,</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">IntWritable</span><span class="o">&gt;</span> <span class="n">values</span><span class="o">,</span> <span class="n">Context</span> <span class="n">context</span><span class="o">)</span>
         <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">InterruptedException</span> <span class="o">{</span>
         <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
         <span class="k">for</span> <span class="o">(</span><span class="n">IntWritable</span> <span class="n">val</span> <span class="o">:</span> <span class="n">values</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">sum</span> <span class="o">+=</span> <span class="n">val</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
         <span class="o">}</span>
         <span class="n">context</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="k">new</span> <span class="n">IntWritable</span><span class="o">(</span><span class="n">sum</span><span class="o">));</span>
      <span class="o">}</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
      <span class="n">Configuration</span> <span class="n">conf</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Configuration</span><span class="o">();</span>

      <span class="n">Job</span> <span class="n">job</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Job</span><span class="o">(</span><span class="n">conf</span><span class="o">,</span> <span class="s">&quot;wordcount&quot;</span><span class="o">);</span>

      <span class="n">job</span><span class="o">.</span><span class="na">setJarByClass</span><span class="o">(</span><span class="n">WordCount</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
      <span class="n">job</span><span class="o">.</span><span class="na">setOutputKeyClass</span><span class="o">(</span><span class="n">Text</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
      <span class="n">job</span><span class="o">.</span><span class="na">setOutputValueClass</span><span class="o">(</span><span class="n">IntWritable</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

      <span class="n">job</span><span class="o">.</span><span class="na">setMapperClass</span><span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
      <span class="n">job</span><span class="o">.</span><span class="na">setReducerClass</span><span class="o">(</span><span class="n">Reduce</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

      <span class="n">job</span><span class="o">.</span><span class="na">setInputFormatClass</span><span class="o">(</span><span class="n">TextInputFormat</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
      <span class="n">job</span><span class="o">.</span><span class="na">setOutputFormatClass</span><span class="o">(</span><span class="n">TextOutputFormat</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

      <span class="n">FileInputFormat</span><span class="o">.</span><span class="na">addInputPath</span><span class="o">(</span><span class="n">job</span><span class="o">,</span> <span class="k">new</span> <span class="n">Path</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]));</span>
      <span class="n">FileOutputFormat</span><span class="o">.</span><span class="na">setOutputPath</span><span class="o">(</span><span class="n">job</span><span class="o">,</span> <span class="k">new</span> <span class="n">Path</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]));</span>

      <span class="n">job</span><span class="o">.</span><span class="na">waitForCompletion</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
   <span class="o">}</span>

<span class="o">}</span></code></pre></div>

<h3 id="compile,-package-&amp;-run!">Compile, Package &amp; Run!</h3>

<p>Our project is setup, our code is in place; it&#39;s now time to compile our project.</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>mvn clean install</code></pre></div>

<p>Lots of downloading of dependencies and a bit of compilation go on . . . If all has gone to plan, you can now have a package to run. As usual, you&#39;ll need a text file of words to count. I&#39;ve popped one up on hdfs called &quot;input.txt&quot;.</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>hadoop jar target/wordcount-1.0-SNAPSHOT.jar input.txt wcout</code></pre></div>

<p>You should now have a map reduce job running!</p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page4">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page2">Newer</a>
    
  
</div>
      </div>
    </div>

  </body>
</html>
