<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Cogs and Levers &middot; A blog full of technical stuff
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>A place for thoughts, ideas, tutorials and bookmarks. My brain can only hold so much, you know.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    

    <a class="sidebar-nav-item" href="https://github.com/tuttlem/tuttlem.github.io">GitHub</a>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2014. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <label for="sidebar-checkbox" class="sidebar-toggle"></label>

          <h3 class="masthead-title">
            <a href="/" title="Home">Cogs and Levers</a>
            <small>A blog full of technical stuff</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2012/12/30/unit-testing-with-quickcheck/">
        Unit Testing with QuickCheck
      </a>
    </h1>

    <span class="post-date">30 Dec 2012</span>

    <h1>Unit Testing with QuickCheck</h1>
<div class='post'>
<h3>Introduction</h3><div>Seems I'm forever making card games <i>in Haskell</i>, so it only seemed right that I try and make a library of routines and data types that will get me going quicker. Don't get me wrong, I intend on doing something serious with Haskell one day - I just seriously lack the chops to do so right now.</div><div><br /></div><div>As with any development process, you as a developer should write unit tests. Not only is it good practice but it also gives you a repeatable base of executions to assure you that the last change you put in won't break your masterpiece.</div><div><br /></div><div>Today I want to talk about the <a href="http://en.wikipedia.org/wiki/QuickCheck">QuickCheck</a> unit testing library for Haskell.</div><div><br /></div><h3>What are we testing?</h3><div>To give you an idea of the playing field we're on, I'll just post some of the simple routines that I have done so far. First up is the data types that will help us represent a single playing card.</div><div><br /><script src="https://gist.github.com/4412543.js"></script></div><div><br /></div><div><br /></div><div>A card has a suit and a value. Pretty straight forward. I could have made a type that wrapped an array of the Card type and called it "Deck", but I'm happy just handling an array of Card. Now to build a deck and to shuffle it!<br /><br /><script src="https://gist.github.com/4412555.js"></script> <br />When a deck is built with "makeDeck" the cards are ordered just like they are when you open a fresh deck of cards, so we need to shuffle them in order to make this game any fun! "seedCards" assigns a random value to each card that it is passed and then "makeShuffledDeck" saves the day by ordering by this random seed to give a shuffled deck.<br /><br />That's all pretty simple still and that's where the "testable" parts stop. So, still the question: what are we testing? Well, I'm sure there are plenty of other scenarios, but for today's purposes we'll test the following:<br /><br /><ul><li>Are there 52 cards in a deck made by "makeDeck"</li><li>Are there still 52 cards in a deck after they've been processed by "makeShuffledDeck"</li><li>Is the deck made by "makeDeck" not in the same order as the deck made by "makeShuffledDeck"?</li></ul><br />Great. With these three scenarios in mind, here's how easy it is to assert these facts using QuickCheck.<br /><br /><script src="https://gist.github.com/4412589.js"></script> <br />As it should be, these tests read rather humanly. And after running this suite of tests we end up with the following results:<br /><br /><pre>+++ OK, passed 1 tests.<br />+++ OK, passed 100 tests.<br />+++ OK, passed 100 tests.</pre><br />Hold on! 100 tests? We only defined 3 tests though. How can this be? You'll see that for the second and third tests actually have an anonymous function passed to them. Because both of these depend on a random number generator (to shuffle the deck), I've passed in <a href="http://hackage.haskell.org/packages/archive/random/latest/doc/html/System-Random.html#v:mkStdGen">mkStdGen</a>'s integer that it maps to a generator from the function's parameter list.<br /><br />QuickCheck grabbed hold of this and rather than just running 1 test, it went ahead and gave the anonymous function 100 random values. That's much better coverage for what is seemingly the cost of defining the test as an anonymous method.<br /><br />Immediately you can see the power of unit testing with such a simple framework and how you can be productive relatively quickly.<br /><br /></div></div>
<h2>Comments</h2>
<div class='comments'>
</div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2012/12/30/blurring-the-lines-between-haskell-and-c/">
        Blurring the lines between Haskell and C
      </a>
    </h1>

    <span class="post-date">30 Dec 2012</span>

    <h1>Blurring the lines between Haskell and C</h1>
<div class='post'>
<h3>Introduction</h3><div>Being able to use parts of code that you have written in different languages in your environment of choice is a great productivity booster. For those particular problems you can really pick the tool that you need.</div><div><br /></div><div>Haskell and C are no exception to this. The Haskell website has a <a href="http://www.haskell.org/haskellwiki/Calling_Haskell_from_C">great little write-up</a> on the topic. In today's post, I'm going to run you through the steps that I followed to get this running.</div><div><br /></div><h3>Write your Haskell</h3><div>The compilation process depends on your Haskell code being written first as GHC will generate some stub code for you.</div><div><br /></div><div>Here's a very simple and crude prime number tester:</div><div><br /><script src="https://gist.github.com/4410052.js"></script></div><div><br />Ignoring my method of primes testing, you can see some interesting pieces in this Haskell source. On the first line we're enabling a GHC extension for the ForeignFucntionInterface. This allows us to export symbols to other languages. We have our implementation actually in the function "is_prime" with "is_prime_hs" being the callable wrapper from outside, in this case C. The last line actually exports our wrapper as a callable function.<br /><br /><h3>Haskell compilation</h3></div><div>You've got your Haskell module ready for compilation, but it's going to be a little bit different. This source is supporting another application rather than containing a main function of its own.</div><div><br /><pre>$ ghc -c -O prime.hs</pre></div><div><br />This command will compile our file only "-c" and optimise "-O". A stub header file is generated for us (thanks to our FFI instructions on the first line of our Haskell file) that we can include in our main program.<br /><br /><h3>Write your C</h3></div><div>It's now time to call our prime function. There is a little bit of administration "fluff" that we have to go through in order to get there, but it's really not much to worry about. Take note that we're including our stub header file that was generated for us in our Haskell compilation step.</div><div><br /><script src="https://gist.github.com/4410375.js"></script></div><div><br /></div><div><br /></div><div>So that's pretty straight-forward C code in the end. It's a little awkward at first to look at the #define rigmarole at the top of the file, but you'll soon see straight past it.<br /><br />You can see at the top of the file that we've got an external symbol representing the module, "Primes". This is used as a secondary initialisation step after we start up FFI (with hs_init). The call to hs_add_root is the extra initialisation required (per module we import - <a href="http://hackage.haskell.org/trac/ghc/ticket/3252">I'm led to believe</a>) that we do for GHC's sake.<br /><br />Your C code is written, it's now time to compile, link and execute! Compilation to produce an executable looks like this.<br /><br /><pre>$ ghc --make -no-hs-main -optc-O call_prime.c Prime -o test</pre><br />We're telling ghc that we want to make (--make) our executable (-o test) that doesn't have a main routine in haskell source (-no-hs-main) and optimised by the c compiler (-optc-O).<br /><br />We should have an executable, ready to go:<br /><br /><pre>$ ./test<br />is 13 prime? 1<br />is 21 prime? 0<br /></pre><br />It's not fireworks, but it's functional.<br /><br /><br /></div></div>
<h2>Comments</h2>
<div class='comments'>
</div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2012/12/29/starting-a-web-application-with-noir/">
        Starting a web application with Noir
      </a>
    </h1>

    <span class="post-date">29 Dec 2012</span>

    <h1>Starting a web application with Noir</h1>
<div class='post'>
<h3>Introduction</h3><div>Looking for something semi-useful to do with my <a href="http://cogsandlevers.blogspot.com.au/2012/12/clojure-and-leiningen-quickstart.html">new installation of Clojure and Leiningen</a>, I thought I'd have a hunt around and look for some web frameworks that I might be able to put a small application together with. The web did not disappoint offering me options of <a href="http://www.webnoir.org/">Noir</a>, <a href="http://www.joodoweb.com/">Joodo</a>, <a href="https://github.com/tatut/Webjure">Webjure</a>, <a href="https://github.com/macourtney/Conjure">Conjure</a>, <a href="https://github.com/cgrand/moustache">Moustache</a>&nbsp;and <a href="https://github.com/weavejester/compojure">Compojure</a>.</div><div><br /></div><div>A feast of frameworks indeed. I looked at all of them very briefly but decided to only investigate one, Noir. I'm sure all of the other frameworks have their benefits over&nbsp;Noir, I just wanted to start somewhere.</div><div><br /></div><div>This post is actually about getting the the&nbsp;Noir&nbsp;Leiningen template installed and getting your first application started. The Noir website will be able to take you further steps.</div><div><br /></div><div>For this post, I'm using <a href="http://mxcl.github.com/homebrew/">homebrew</a> on Mac OSX 10.8.2.<br /><br />My Leiningen version is 1.7.1<br />My Clojure version is 1.4.0</div><div><br /></div><h3>Installation</h3><div>There's no real installation about it. If you have Leiningen installed, you're almost there. I did need some extra help installing the correct template to make Leiningen generate the correct structure for a Noir project.<br /><br />I installed the Noir Leiningen template</div><div><pre>$ lein plugin install noir/lein-template 1.3.0 </pre></div><div><br /></div><div><br /><div>Then I installed the newnew template</div><div><pre>$ lein plugin install lein-newnew 0.2.6 </pre></div><div></div></div><div><br />It was at this point, that I was ready to go!<br /><br /><h3>Get going!</h3></div><div>You should now be able to issue the following instructions at the shell and have a running web application.</div><div><br /></div><div><pre>$ lein new noir my-website</pre><pre>$ cd my-website</pre><pre>$ lein run</pre><br />Your turn! :-)</div></div>
<h2>Comments</h2>
<div class='comments'>
</div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2012/12/29/bridging-science-and-art-with-ruby/">
        Bridging Science and Art with Ruby
      </a>
    </h1>

    <span class="post-date">29 Dec 2012</span>

    <h1>Bridging Science and Art with Ruby</h1>
<div class='post'>
<h3>Introduction</h3><div>Having a love for music and technology at the same time can be a dangerous business. You can really fool yourself into thinking that you can boil art down into algebraic or procedural recipes that you can just turn the handle on. The frustration sets in when it's just not that black-and-white.</div><div><br /></div><div>In this post, I've put some Ruby code together that takes in an array of <a href="http://en.wikipedia.org/wiki/Interval_(music)">musical intervals</a>&nbsp;and attempts to give that array of intervals a name. In music, this is better known as a <a href="http://en.wikipedia.org/wiki/Chord_(music)">chord</a>&nbsp;or <a href="http://en.wikipedia.org/wiki/Arpeggio">arpeggio</a>.&nbsp;</div><div><br /></div><h3>Assumptions</h3><div>As above, I want an array of intervals in so this is going to take shape in the form of an integer array. These integers will be the individual distances (in semi-tones) from the root which will start at 0. For reference, here's a chart that I used during development.</div><div><br /><table><tbody><tr><th>First Octave</th><th>Second Octave</th><th>Interval Names</th></tr><tr><td><span style="color: red;">0</span></td><td><span style="color: red;">12</span></td><td>Root/Unison</td></tr><tr><td>1</td><td>13</td><td>Minor Second/Flat Nine</td></tr><tr><td>2</td><td>14</td><td>Major Second/Nine</td></tr><tr><td>3</td><td><span style="color: red;">15</span></td><td>Minor Third</td></tr><tr><td>4</td><td><span style="color: red;">16</span></td><td>Major Third</td></tr><tr><td>5</td><td>17</td><td>Perfect Fourth/Eleventh</td></tr><tr><td>6</td><td>18</td><td>Tritone/Sharp Eleven</td></tr><tr><td>7</td><td><span style="color: red;">19</span></td><td>Perfect Fifth</td></tr><tr><td>8</td><td>20</td><td>Minor Sixth/Flat Thirteen</td></tr><tr><td>9</td><td>21</td><td>Major Sixth/Thirteenth</td></tr><tr><td>10</td><td><span style="color: red;">22</span></td><td>Minor Seventh</td></tr><tr><td>11</td><td><span style="color: red;">23</span></td><td>Major Seventh</td></tr></tbody></table></div><div><br />Intervals that are coloured red, didn't really factor into the overall solution as they add nothing to the chord's quality or extension. Well, this may not be entirely true, some jazz-heads have probably already got their cross-hairs locked onto me, ready to flame away.<br /><br /><h3>Gathering facts</h3></div><div>First of all, we need the array of intervals into our class. We'll always assume that there is a root and if there isn't one, we'll pop one into the array for good measure.</div><div><br /><script src="https://gist.github.com/4406523.js"></script></div><div><br /></div><div><br /></div><div>We're now managing an array of intervals. What we need to do is ask questions of that array so we can gather information about our chord. The following methods ask the important questions in the first octave.<br /><br /><script src="https://gist.github.com/4406546.js"></script> <br />With just this base information we can find a lot out about the chord, but it's not nearly enough. We need to be sure. The best part about putting these basic building blocks in place is that our methods are going to read a little more human from now on. Here are some more fact finders.<br /><br /><script src="https://gist.github.com/4406556.js"></script> <br />Finally we have a couple more tests that we need to conduct on the array in the upper octave, otherwise none of the jazz-guys are going to get their chords! These again will form syntactic sugar for the main feature, to_s.<br /><br /><script src="https://gist.github.com/4406565.js"></script> <br /><br /><h3>Piecing it together</h3></div><div>It's good that we know so much about our chord. It means that we can ask questions and make decisions based on the outcomes of these questions. Upon reflection, I did have another idea on assembling those fact-finding methods into a more flexible but highly-unhuman set of methods that when you asked about a particular interval, you'd get back either :flat, :natural or :sharp. Perhaps I'll try it in another revision; I digress.</div><div><br /></div><div>All the facts are in front of us, let's construct a string from these facts. Now here's where the awkward bridge between science and art starts to burn a little, then a lot. Questions must not only be asked of the array, but they have to be asked in the right order otherwise you'll get a different result.</div><div><br /></div><div>That's naming for you though. It doesn't read pretty, but here it is.</div><div><br /><script src="https://gist.github.com/4406569.js"></script></div><div><br /></div><div><br /></div><div>Woosh. That was a lot of if-treeing. There has to be a better way of doing this, but by my calculations using this code I've covered the following use-cases off:<br /><br /><br /><ul><li>Major</li><li>Minor</li><li>Diminished</li><li>Diminished Seventh</li><li>Augmented</li><li>Seventh</li><li>Minor Seventh</li><li>Major Seventh</li><li>Suspended Second</li><li>Suspended Fourth</li><li>Seventh Flat 5</li><li>Seventh Sharp 5</li><li>Major Seventh Flat 5</li><li>Major Seventh Sharp 5</li><li>Minor Seventh Flat 5</li><li>Minor Seventh Sharp 5</li><li>Ninth</li><li>Eleventh</li><li>Thirteenth</li></ul><div>There's a few chords there, but there are just so many more and this code may work for them. Those other cases just haven't made it into my unit tests yet.</div><div><br /></div><h3>Plans</h3><div>I really want to make this part of a bigger application that I'm writing at the moment. I was motivated to write a unit like this because I didn't want chord definitions just sitting in a database, I wanted the application to do the think work. Possibilities from here also reach into inversions and slash chords. It would be easy to permute the list of intervals and enumerate all of the inversion scenarios.</div><div><br /></div><div>Anyway, until next time!</div></div></div>
<h2>Comments</h2>
<div class='comments'>
</div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2012/12/28/installing-haskell-platform-on-debian/">
        Installing haskell-platform on Debian
      </a>
    </h1>

    <span class="post-date">28 Dec 2012</span>

    <h1>Installing haskell-platform on Debian</h1>
<div class='post'>
If you are only using the stable repositories for your Debian installation, you'll have an older version of haskell-platform running on your system. In this post, I'll show you how to enable the <a href="http://wiki.debian.org/DebianUnstable">unstable</a>&nbsp;repository and get the latest version of <a href="http://packages.debian.org/sid/haskell-platform">haskell-platform</a> installed.<br /><br />First up, you need to enable the unstable repository by adding the following line to your /etc/apt/sources.list<br /><br /><pre>deb http://mirror.aarnet.edu.au/debian/ unstable main</pre><br />You should replace the mirror that I've specified above with one that is suitably close to where installation commands are executing.<br /><br />Next, if one doesn't yet exist, create a /etc/apt/preferences file and edit it. Once you're editing, add the following lines to set apt's preferences as to which repository it will favor<br /><br /><pre>Package: *<br />Pin: release a=squeeze   <br />Pin-Priority: 900<br /><br />Package: *<br />Pin: release a=unstable <br />Pin-Priority: 800</pre><br />So, the stable repository (squeeze) is still in charge overall but unstable packages will be available to you at request.<br /><br />Update aptitude's package database now from the newly added repository<br /><br /><pre># aptitude update</pre><br />A very handy tid-bit at this point is that you'll now be able to see all of the versions of a package that are available to you with respect to their originating respository.<br /><br /><pre>$ aptitude versions haskell-platform<br />p   2010.1.0.0.1                                  stable                    500<br />i   2012.2.0.0                                    unstable                  800<br /></pre><br />Finally, you can get to installing the&nbsp;<a href="http://packages.debian.org/sid/haskell-platform">haskell-platform</a>&nbsp;package from the unstable repository<br /><br /><pre># aptitude install haskell-platform/unstable</pre><br />That's it. You're ready to go.</div>
<h2>Comments</h2>
<div class='comments'>
</div>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page27">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page25">Newer</a>
    
  
</div>
      </div>
    </div>

  </body>
</html>
