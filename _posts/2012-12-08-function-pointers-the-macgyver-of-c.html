---
layout: post
title: Function Pointers, the MacGyver of C
date: 2012-12-08
comments: false
---

<h1>{{ page.title }}</h1>
<div class='post'>
<h3>Introduction</h3><div>It's a very well studied topic in the C field. Many people have written tutorials on how to use function pointers and what they are. <a href="http://www.newty.de/fpt/fpt.html">The function pointer tutorial</a> is always a good read for the uninitiated or seasoned professional who's function pointer theory is a little rusty.</div><div><br /></div><div>This write up isn't going to try and fill the shoes of the basic-square-1-hello-world style tutorial. I just wanted to talk about how I've used them to better a piece of code and make a system a bit more extensible overall.</div><div><br /></div><h3>What are they?</h3><div>Like any data pointer a function pointer is an address. It's an address that will point to the entry-point of some code. It's that simple. The complexity comes into the argument when you start to add C syntax. C likes to be very descriptive with the data that you're feeding functions and function parameters are no exception.</div><div><br /><script src="https://gist.github.com/4238320.js?file=gistfile1.c"></script></div><div><br /></div><div><br /></div><div>Ok, simple example time over. It's onto what this article is really about.<br /><br /><h3>Problem description</h3></div><div>I have a game that has a few game states. They look like this:</div><div><ul><li>Introduction credits</li><li>Game title</li><li>Menu</li><li>Game play</li><li>Game over</li><li>High score board</li></ul><div>Each of these states all have functionality that they need to accomplish. The basic specification for a game state goes as follows:</div></div><div><ul><li>Needs to be able to be initialized</li><li>Needs to be able to have its resources freed (tear down)</li><li>Needs to be able to update its internal logic</li><li>Needs to be able to render its internal state&nbsp;</li><li>Needs to be able to respond to events (keyboard, etc)</li></ul><div>Good. We've established that we have a set of game states and they all attract a set of actions that we'd like them to perform.</div></div><div><br /><h3>Getting down to it</h3><br /></div><div>So, let's define the actions first (as function pointers) and we can then fill in the implementation later:</div><div><br /><script src="https://gist.github.com/4238398.js?file=gistfile1.c"></script></div><div><br /></div><div><br /></div><div>Slightly different from above is the use of the "typedef" keyword. This allows us to define these function pointers as types so that we can treat them just as we do any other type. These types that we've defined are the outline to what we need. We still have the colour in, but we've got a framework ready to go.<br /><br />Lets define our function pointer variables using the types we defined above.<br /><br /><script src="https://gist.github.com/4238417.js?file=gistfile1.c"></script> <br />Simple enough. Now that we have these variables define (close-by to our game loop), we can write a game loop that will look a little something like this:<br /><br /><script src="https://gist.github.com/4238422.js?file=gistfile1.c"></script> <br /><br />This is psuedo code really. There's a whole heap of infrastructure that you'll need in order to make this work.<br /><br />You can see that only 3 of the functions we require are being are being used at the moment. We still need to get the init and teardown involved. The game module also needs a way to shift between game states.<br /><br />Thankfully, both of these functions come together in the one function:<br /><br /><script src="https://gist.github.com/4238435.js?file=gistfile1.c"></script> <br />So, this function tearsdown the existing game state (if we have a state), and initializes if we initialize to a valid state. Easy!!<br /><br />Well, this has been just one possible use for function pointers. You can do so much, much more with them, but I thought I'd share my use of them here!<br /><br /></div></div>
<h2>Comments</h2>
<div class='comments'>
</div>
