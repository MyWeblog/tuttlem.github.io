---
layout: post
title: OS Kernel Development: Environment
date: 2012-12-31
comments: false
---

<h1>{{ page.title }}</h1>
<div class='post'>
<h3>Introduction</h3><div>I'm working on an operating system at the moment just for a bit of fun to fill in some of the gaps when I find them. It's in no way a competitor to the <a href="http://kernel.org/">big</a> <a href="https://lists.apple.com/mailman/listinfo/darwin-kernel">boys</a> <a href="http://en.wikipedia.org/wiki/Windows_kernel">in</a> <a href="http://www.freebsd.org/cgi/cvsweb.cgi/">the</a> <a href="http://en.wikipedia.org/wiki/IBM_AIX">market</a>, it's just a sandbox that I can try stuff out in, blow stuff up, you get the picture.</div><div><br /></div><div>So, I thought I might post of my journey through the OS kernel development rabbit-hole and see where it takes us. The first post, I'd like to talk about setting up a development environment that makes it a piece of cake to make changes to your source and test your changes rapidly.</div><div><br /></div><div>At any time, you can pull down the code for the progress that I've made so far in my github repository <a href="https://github.com/tuttlem/phoenix">here</a>.</div><div><br /></div><h3>Assumptions</h3><div>Unless you're interested in getting nowhere fast - some assumptions have to be made. This is a very complex development and testing process so in the interest of maintaining the hair on your head you have to pick some technologies.</div><div><br />Development of this operating system is done on any POSIX style OS.<br /><br /></div><div>Rather than writing a bootloader of my own, I've made this project follow the multi-boot standard and it'll boot through grub.</div><div><br /></div><div>With this said, to begin with you'll need to prepare yourself a floppy disk image with grub installed. There are <a href="https://help.ubuntu.com/community/GrubHowto/BootFloppy">plenty</a>&nbsp;of <a href="http://wiki.osdev.org/Disk_Images">resources</a> <a href="http://cstein.kings.cam.ac.uk/~chris/bootgrub.html">around</a> the <a href="http://orgs.man.ac.uk/documentation/grub/grub_3.html">web</a> that you can follow to get this accomplished. If you are really struggling though, I have a floppy.img file sitting in the bin folder of phoenix&nbsp;<a href="https://github.com/tuttlem/phoenix">here</a>.</div><div><br /></div><h3>Virtualise!</h3><div>I don't have spare computer around to test my OS on every time.. well, that's actually a big-fat-lie. I've got heaps of computers around here that I could test my code on, but I just couldn't be bothered. I'm much prefer to manage the process virtually using the free virtual machine manager <a href="http://bochs.sourceforge.net/">Bochs</a>.&nbsp;</div><div><br /></div><div>If you setup your build script right, you'll be able to compile your kernel and add it to the boot floppy ready for grub to execute. All you really need to do is run Bochs to check out the results.</div><div><br /></div><div>You can use the following to add a kernel image to the grub floppy.</div><div><br /><pre class="brush:shell">#!/bin/bash<br /><br />sudo losetup /dev/loop0 floppy.img<br />sudo mount /dev/loop0 /mnt<br />sudo cp kernel /mnt/kernel<br />sudo umount /dev/loop0<br />sudo losetup -d /dev/loop0</pre></div><div><br />Actually getting the image in there is quite easy. You'll also need a bochs configuration file to look like this as follows.<br /><br /><pre>boot: floppy<br />floppya: 1_44="bin/floppy.img", status=inserted<br /></pre><br />Alright, I've left you here in a pretty inconsistent state. You've got the environment, but nothing to do in it just yet. In my next tutorial, I'll walk you though the boot code and making it over into C land!<br /><br />Stay tuned.</div></div>
<h2>Comments</h2>
<div class='comments'>
</div>
