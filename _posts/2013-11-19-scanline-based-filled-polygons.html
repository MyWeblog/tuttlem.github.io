---
layout: post
title: Scanline based filled Polygons
date: 2013-11-19
comments: false
---

<h1>{{ page.title }}</h1>
<div class='post'>
<h3>Introduction</h3>In a <a href="http://cogsandlevers.blogspot.com.au/2013/11/pixel-access-to-canvas-with-javascript.html">previous post</a> I laid down some foundation code to get access to the pixel buffer when in context of a HTML canvas. Good for those who have experience writing graphics code directly against the video buffer - it almost feels like you're writing to 0xA000 :-)<br /><br />Today's post will focus on drawing polygons to the screen using scan lines.<br /><br /><h3>Scan lines</h3>The whole idea here is that a polygon can be represented on screen as a series of horizontal lines. Take the following picture for example. You can see the red and blue horizontal lines making up the filling of the polygon.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-7VZcWuk1AkQ/UotS_qdPXrI/AAAAAAAAAwM/DlKjKBnH2lA/s1600/y.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="200" src="http://1.bp.blogspot.com/-7VZcWuk1AkQ/UotS_qdPXrI/AAAAAAAAAwM/DlKjKBnH2lA/s200/y.png" width="200" /></a></div><br />So, to define this all we do is take note of the minimum and maximum x values for every y-axis instance that there is a line on. We run through the array of values drawing horizontal lines at each instance, and then we have a polygon on screen - pretty easy.<br /><br /><h3>Code</h3>First of all, we'll define our drawing primitive for a horizontal line.<br /><br /><br /><script src="https://gist.github.com/tuttlem/7544385.js"></script> <br />We pass in the two x values for the line to go between, the y value for the line to sit on. To help with the offset calculation we also pass in the width "w" to correctly calculate the pitch. Finally the colour components and buffer to draw to are passed in. Setting this code up in a run loop, you end up with something like this:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-QMhBzwZnDUI/UotUjD3Cj4I/AAAAAAAAAwY/JxoFPAPDovE/s1600/Screen+Shot+2013-11-19+at+10.06.53+pm.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="222" src="http://2.bp.blogspot.com/-QMhBzwZnDUI/UotUjD3Cj4I/AAAAAAAAAwY/JxoFPAPDovE/s320/Screen+Shot+2013-11-19+at+10.06.53+pm.png" width="320" /></a></div>Yep, there's lots of horizontal lines.<br /><br />Referring to our horizontal line diagram above, we still need a way to walk the edges of the polygon so that we can get the minimum and maximum x values to start drawing. Because our basic unit is the pixel (considering we're rasterising to a pixelated display), we can easily calculate the gradient of the line that we need by:<br /><br /><pre>(change in x) / (change in y)<br /><br />For a line given by (x1, y1) - (x2, y2), this translates into:<br /><br />(x2 - x1) / (y2 - y1)<br /></pre><br />Taken out of context of maths, this just says to us: we want to walk from x1 to x2 using (y2 - y1) steps.<br /><br /><br /><script src="https://gist.github.com/tuttlem/7544449.js"></script> <br />From the code above, we treat x1, y1 as the starting point and x2, y2 as the ending point. Our for-loop is biased in the positive direction, so it's important for us to flip the values if they come in inverted.<br /><br />The edges array that's passed in is prepared by the caller of this function. It's initialized with very unreasonable minimum and maximum values. We than run over all 4 polygon edges<br /><br /><pre>(x1, y1) -&gt; (x2, y2)<br /><br />(x2, y2) -&gt; (x3, y3)<br /><br />(x3, y3) -&gt; (x4, y4)<br /><br />(x4, y4) -&gt; (x1, y1)<br /><br /></pre><br />At the end of this process, "edges" is full of minimum/maximum values ready for drawing. Here's the code for the polygon.<br /><br /><br /><script src="https://gist.github.com/tuttlem/7544554.js"></script> <br />This really is just putting all the pieces together. The building of the edges array is important - as is using the y co-ordinate (adjusted back to zero by proxy of the minimum y value) as an array index.<br /><br />Once you've got this setup in a random position &amp; colour loop, you'll end up with something like this:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-D2yDU9iTdc0/UotZcoZ2jtI/AAAAAAAAAwo/QCW0Qi8rhSQ/s1600/Screen+Shot+2013-11-19+at+10.27.57+pm.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="200" src="http://3.bp.blogspot.com/-D2yDU9iTdc0/UotZcoZ2jtI/AAAAAAAAAwo/QCW0Qi8rhSQ/s320/Screen+Shot+2013-11-19+at+10.27.57+pm.png" width="320" /></a></div><br />mmmm... Tasty.<br /><br /></div>
<h2>Comments</h2>
<div class='comments'>
</div>
