<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Cogs and Levers &middot; A blog full of technical stuff
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>A place for thoughts, ideas, tutorials and bookmarks. My brain can only hold so much, you know.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    

    <a class="sidebar-nav-item" href="https://github.com/tuttlem/tuttlem.github.io">GitHub</a>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2014. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <label for="sidebar-checkbox" class="sidebar-toggle"></label>

          <h3 class="masthead-title">
            <a href="/" title="Home">Cogs and Levers</a>
            <small>A blog full of technical stuff</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2013/01/07/assembly-on-osx/">
        Assembly on OSX
      </a>
    </h1>

    <span class="post-date">07 Jan 2013</span>

    <h1>Assembly on OSX</h1>
<div class='post'>
<h3>Introduction</h3><div>I've <a href="http://cogsandlevers.blogspot.com.au/2012/11/hello-64bit-assembly.html">previously written</a> about writing "Hello World" applications in assembly for 64bit architectures in a Unix environment, however I haven't written about the nuances of doing this in OSX.</div><div><br /></div><div>My primary environment that I work in at home is OSX, so I wanted to get this post out of the way anyway so that I've got assembly &amp; linking instructions written down. To follow along, you'll want to install <a href="http://www.nasm.us/">NASM</a>.</div><div><br /></div><h3>The Code</h3><div><br /><script src="https://gist.github.com/4474479.js"></script></div><br />I've tried to comment the code above as best I can. It's pretty clear to see that we're calling the <a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?write+2">write</a> and <a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?exit+2">exit</a> syscalls. The only line that stands out is having to adjust esp after our write syscall. Regardless, this is what OSX expects!<br /><br />Building this application into something runnable for mach is pretty simple. You assemble the file into an object file like so.<br /><br /><pre class="brush:shell">$ nasm -f macho hello.asm</pre><br />And link it as an executable like so.<br /><br /><pre class="brush:shell">$ ld -e _start -o hello hello.o</pre><br />Pretty simple. You're now ready to attack OSX with your assembler!<br /><br /><h3>In 64bits please!</h3><div>Continuing the discussion a bit further, we can bring our program into today by upgrading NASM to a version that supports the macho64 format. The source to our program changes a bit, especially the way that we pass parameters into our syscalls now. The <a href="http://en.wikipedia.org/wiki/Application_binary_interface">ABI</a> had changed dramatically favouring separate registers to pass values as opposed to using the stack.<br /><br />Here's the 64bit source.</div><div><br /></div><div><br /><script src="https://gist.github.com/4474618.js"></script></div><div><br /></div><div><br /></div>It still does look a lot like its 32bit counterpart. Notice how we're not magically adjusting esp by hand now? Those parameters being passed as registers has helped!<br /><br />Assembling your 64bit assembly code now looks like this.<br /><br /><pre class="brush:shell">$ nasm -f macho64 hello64.asm</pre><br />And link it as an executable like so.<br /><br /><pre class="brush:shell">$ ld -e _start -o hello64 hello64.o</pre><br />This is a good place to be. Now you've got choice!</div>
<h2>Comments</h2>
<div class='comments'>
</div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2013/01/06/sending-email-with-gmail-and-ruby/">
        Sending email with GMail and Ruby
      </a>
    </h1>

    <span class="post-date">06 Jan 2013</span>

    <h1>Sending email with GMail and Ruby</h1>
<div class='post'>
Here's a quick little ruby snippet to get you sending email through your gmail account. I had to implement this recently, so I thought I'd make note of it here.<br /><br />You will need the <a href="http://rubygems.org/gems/tlsmail">tlsmail</a> gem install to make this happen.<br /><br />Here's the code.<br /><br /><script src="https://gist.github.com/4466102.js"></script> <br />That is what it's all about!</div>
<h2>Comments</h2>
<div class='comments'>
</div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2013/01/06/node-js-screencasts/">
        node.js Screencasts
      </a>
    </h1>

    <span class="post-date">06 Jan 2013</span>

    <h1>node.js Screencasts</h1>
<div class='post'>
I think that if I was to dip my toes any further into the pool that is node.js, I'll be hitting up this set of free screencasts.<br /><br /><a href="https://learni.st/users/tilley.brandon/boards/3254-nodecasts-node-js-screencasts">https://learni.st/users/tilley.brandon/boards/3254-nodecasts-node-js-screencasts</a><br /><br /></div>
<h2>Comments</h2>
<div class='comments'>
</div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2013/01/06/impure-worlds-side-effects-and-io/">
        Impure worlds, side effects and IO
      </a>
    </h1>

    <span class="post-date">06 Jan 2013</span>

    <h1>Impure worlds, side effects and IO</h1>
<div class='post'>
<h3>Introduction</h3><div>I've only just made it to chapter 8 in the book <a href="http://learnyouahaskell.com/">Learn You a Haskell for Great Good!</a>&nbsp;as as I've been going through it, most of it has been assumed knowledge without a lot of the understanding. I never needed to understand Haskell's separation of pure functional from impure code in order to print "Hello World" to the screen.</div><div><br /></div><div>After reading Chapter 8, I'm convinced that I should have known. I'm glad I do now.</div><div><br /></div><h3>Impure worlds</h3><div>Haskell goes to great lengths to ensure the code that you're writing is purely functional. That is, no state, no side-effects, function guarantees on outputs for given inputs. Fantastic. Great. But how do you make Haskell do something interesting then?</div><div><br /></div><div>In order to introduce the outside world into our pure environment we use "IO actions". The are actions that can (but don't have to) emit a result that will be of interest to our program. These actions are said to have side effects.<br /><br />I could continue on here but I wouldn't do the topic the justice it deserves, so do yourself a favour and read up on it.<br /><br />From here, I'll just present the code-level concepts that I want to make note of.<br /><br /><h3>Oganised Randomness</h3></div><div>One topic that's interesting came to me when I was unit testing a card shuffling solution. In order to implement shuffling, I needed to call on <a href="http://hackage.haskell.org/packages/archive/random/1.0.0.3/doc/html/System-Random.html">System.Random</a>. To get a generator, you can use <a href="http://hackage.haskell.org/packages/archive/random/latest/doc/html/System-Random.html#v:mkStdGen">mkStdGen</a>&nbsp;which takes in an integer to produce a random number generator. A more unpredictable approach is&nbsp;&nbsp;to get this integer from some form of entropic pool outside by proxy of <a href="http://hackage.haskell.org/packages/archive/random/latest/doc/html/System-Random.html#v:getStdGen">getStdGen</a>.&nbsp;</div><div><br /></div><div>We can predictably re-create the same random number generator by supplying&nbsp;<a href="http://hackage.haskell.org/packages/archive/random/latest/doc/html/System-Random.html#v:mkStdGen">mkStdGen</a>&nbsp;with the same number. This is good for our unit tests as we can structure our tests according to these psuedo-random results. Of course, the number that's passed to&nbsp;<a href="http://hackage.haskell.org/packages/archive/random/latest/doc/html/System-Random.html#v:mkStdGen">mkStdGen</a>&nbsp;I had setup as a lambda parameter so that <a href="http://hackage.haskell.org/package/QuickCheck">QuickCheck</a> would produce 100 different scenarios to test out.</div><div><br /></div><div>Anyway, on to some topics.</div><div><br /></div><h3>"Do" syntax</h3><div>"Do" syntax allows us to concatenate many IO actions together without making our code look like soup.</div><div><br /><script src="https://gist.github.com/4461704.js"></script></div><div><br />This is equivalent to this. <br /><script src="https://gist.github.com/4461713.js"></script> <br /><br />While we're inside the scope of "Do" syntax, we use the "&lt;-" construct to remove the IO off a result that comes from the outside world. Once we've done this, we can start using that value in our pure world!<br /><br />The inverse of the "&lt;-" is a "return" statement. A "return" will take a pure value and turn it into an IO action.<br /><br /><h3>when</h3></div><div>"when" is a function from Control.Monad and is used in conjunction with IO actions. "when" is used much like an "if" construct in other languages only when the condition is True, it'll return the supplied IO action otherwise it'll send out an empty IO action or IO (). Here's an example of its use.</div><div><br /><script src="https://gist.github.com/4461741.js"></script></div><div>When running, if this program receives "John" for the input, then John will get a message back. Anyone else, and they'll get nothing.<br /><br /><h3>sequence</h3></div><div>"sequence" will execute a batch (or a List) of IO actions. Here is an example where the program will ask for three strings (so there's a List of actions there) and then after that it'll use sequence and map to print those colours back to the user.</div><div><br /><script src="https://gist.github.com/4461784.js"></script></div><div><br /><h3>mapM and mapM_</h3></div><div>In the previous example, the usage of sequence in conjunction with map earned its own shortcut with mapM. Re-writing the last statement in the previous example with mapM.</div><div><br /><script src="https://gist.github.com/4461801.js"></script></div><div><br />It would have been more appropriate for me to use mapM_ as the difference is that it drops the result.<br /><br /><h3>forever</h3></div><div>As the name suggests, "forever" will execute an IO action forever.</div><div><br /><script src="https://gist.github.com/4461820.js"></script></div><div><br /><h3>forM</h3></div><div>"forM" is pretty much "mapM" only with the parameters shuffled around. It's a little more conducive to passing lambda expressions into it for a very neat and tidy feel.</div><div><br /><script src="https://gist.github.com/4461858.js"></script></div><div><br /></div><div><br /></div><div>That's pretty handy being able to "return" your value from the lambda body back into the assignment.<br /><br /><h3>Getting input from outside</h3><div>Being able to process the STDIN stream is a basic building block for a lot of programs in general. This text processing "duty" is made very simple in Haskell through the use of <a href="http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:getContents">getContents</a> and even easier through <a href="http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:interact">interact</a>.</div><div><br /></div><div>The example program that I've got here uses <a href="http://hackage.haskell.org/packages/archive/base/latest/doc/html/Data-Bits.html#v:xor">`xor`</a>&nbsp;to scramble how a string looks visually. By applying the same function over the scrambled string, we're returned to the original string.</div><div><br /></div><div>Heres the code.</div><div><br /><script src="https://gist.github.com/4466869.js"></script></div><div><br /></div><a href="http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:getContents">getContents</a>&nbsp;works like any other STDIN reader where we might use redirection at the shell to send a text file to it or we might just be entering strings at the console like so.<br /><br /><pre>$ runhaskell scramble.hs <br />Hello<br />M`iij<br />Yes sir-ee bob!<br />\`v%vlw(``%gjg$<br /></pre><br />Not quite "encryption" is it, but it'll do to demonstrate with. Using&nbsp;<a href="http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:interact">interact</a>&nbsp;just cleans up the main function so that it will look like this.<br /><br /><script src="https://gist.github.com/4466880.js"></script> <br /><a href="http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:interact">interact</a>&nbsp;is purpose built for this scenario as this is quite a common task.<br /><br /><h3>Command line parameters</h3><div>The other major source of external interaction to programs is through the command line, passing parameters in. Both <a href="http://hackage.haskell.org/packages/archive/base/latest/doc/html/System-Environment.html#v:getProgName">getProgName</a> and <a href="http://hackage.haskell.org/packages/archive/base/latest/doc/html/System-Environment.html#v:getArgs">getArgs</a> will put you on par with any other environment looking like this.</div><div><br /><script src="https://gist.github.com/4467008.js"></script></div><div><br /></div><br />That's it for IO. I'm going to try and apply this knowledge into some of my projects.</div><div><br /></div></div>
<h2>Comments</h2>
<div class='comments'>
</div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2013/01/06/exception-handling-with-bracket/">
        Exception handling with bracket
      </a>
    </h1>

    <span class="post-date">06 Jan 2013</span>

    <h1>Exception handling with bracket</h1>
<div class='post'>
<h3>Introduction</h3><div>Performing IO in our pure environments can be dangerous. Who knows what people put in files that our programs are expected to read? There are tools that can help assure ourselves that we'll at least clean up if an explosion occurs.</div><div><br /></div><div>In this post, I'll talk about exception handling with IO actions using <a href="http://hackage.haskell.org/packages/archive/base/latest/doc/html/Control-Exception-Base.html#v:bracket">bracket</a>.</div><div><br /></div><h3>What is it?</h3><div><a href="http://hackage.haskell.org/packages/archive/base/latest/doc/html/Control-Exception-Base.html#v:bracket">bracket</a>&nbsp;is a function defined in Control.Exception and is defined as follows.</div><div><br /><script src="https://gist.github.com/4467064.js"></script></div><div><br />Its first parameter is a function that acquires a resource (or handle). Its second parameter is a function that releases the resource acquired in the first. The last parameter is another function that uses the acquired handle to get a result.<br /><br />The error handling comes in because the 2nd parameter, the function that releases the acquired resource is called even if an exception occurs during the execution of the last parameter.<br /><br />That's nifty. An example use of bracket looks as follows.<br /><br /><script src="https://gist.github.com/4467094.js"></script> So, there's another safety mat for when you venture into the impure world.</div></div>
<h2>Comments</h2>
<div class='comments'>
</div>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page23">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page21">Newer</a>
    
  
</div>
      </div>
    </div>

  </body>
</html>
