---
layout: post
title: Impure worlds, side effects and IO
date: 2013-01-06
comments: false
---

<h1>{{ page.title }}</h1>
<div class='post'>
<h3>Introduction</h3><div>I've only just made it to chapter 8 in the book <a href="http://learnyouahaskell.com/">Learn You a Haskell for Great Good!</a>&nbsp;as as I've been going through it, most of it has been assumed knowledge without a lot of the understanding. I never needed to understand Haskell's separation of pure functional from impure code in order to print "Hello World" to the screen.</div><div><br /></div><div>After reading Chapter 8, I'm convinced that I should have known. I'm glad I do now.</div><div><br /></div><h3>Impure worlds</h3><div>Haskell goes to great lengths to ensure the code that you're writing is purely functional. That is, no state, no side-effects, function guarantees on outputs for given inputs. Fantastic. Great. But how do you make Haskell do something interesting then?</div><div><br /></div><div>In order to introduce the outside world into our pure environment we use "IO actions". The are actions that can (but don't have to) emit a result that will be of interest to our program. These actions are said to have side effects.<br /><br />I could continue on here but I wouldn't do the topic the justice it deserves, so do yourself a favour and read up on it.<br /><br />From here, I'll just present the code-level concepts that I want to make note of.<br /><br /><h3>Oganised Randomness</h3></div><div>One topic that's interesting came to me when I was unit testing a card shuffling solution. In order to implement shuffling, I needed to call on <a href="http://hackage.haskell.org/packages/archive/random/1.0.0.3/doc/html/System-Random.html">System.Random</a>. To get a generator, you can use <a href="http://hackage.haskell.org/packages/archive/random/latest/doc/html/System-Random.html#v:mkStdGen">mkStdGen</a>&nbsp;which takes in an integer to produce a random number generator. A more unpredictable approach is&nbsp;&nbsp;to get this integer from some form of entropic pool outside by proxy of <a href="http://hackage.haskell.org/packages/archive/random/latest/doc/html/System-Random.html#v:getStdGen">getStdGen</a>.&nbsp;</div><div><br /></div><div>We can predictably re-create the same random number generator by supplying&nbsp;<a href="http://hackage.haskell.org/packages/archive/random/latest/doc/html/System-Random.html#v:mkStdGen">mkStdGen</a>&nbsp;with the same number. This is good for our unit tests as we can structure our tests according to these psuedo-random results. Of course, the number that's passed to&nbsp;<a href="http://hackage.haskell.org/packages/archive/random/latest/doc/html/System-Random.html#v:mkStdGen">mkStdGen</a>&nbsp;I had setup as a lambda parameter so that <a href="http://hackage.haskell.org/package/QuickCheck">QuickCheck</a> would produce 100 different scenarios to test out.</div><div><br /></div><div>Anyway, on to some topics.</div><div><br /></div><h3>"Do" syntax</h3><div>"Do" syntax allows us to concatenate many IO actions together without making our code look like soup.</div><div><br /><script src="https://gist.github.com/4461704.js"></script></div><div><br />This is equivalent to this. <br /><script src="https://gist.github.com/4461713.js"></script> <br /><br />While we're inside the scope of "Do" syntax, we use the "&lt;-" construct to remove the IO off a result that comes from the outside world. Once we've done this, we can start using that value in our pure world!<br /><br />The inverse of the "&lt;-" is a "return" statement. A "return" will take a pure value and turn it into an IO action.<br /><br /><h3>when</h3></div><div>"when" is a function from Control.Monad and is used in conjunction with IO actions. "when" is used much like an "if" construct in other languages only when the condition is True, it'll return the supplied IO action otherwise it'll send out an empty IO action or IO (). Here's an example of its use.</div><div><br /><script src="https://gist.github.com/4461741.js"></script></div><div>When running, if this program receives "John" for the input, then John will get a message back. Anyone else, and they'll get nothing.<br /><br /><h3>sequence</h3></div><div>"sequence" will execute a batch (or a List) of IO actions. Here is an example where the program will ask for three strings (so there's a List of actions there) and then after that it'll use sequence and map to print those colours back to the user.</div><div><br /><script src="https://gist.github.com/4461784.js"></script></div><div><br /><h3>mapM and mapM_</h3></div><div>In the previous example, the usage of sequence in conjunction with map earned its own shortcut with mapM. Re-writing the last statement in the previous example with mapM.</div><div><br /><script src="https://gist.github.com/4461801.js"></script></div><div><br />It would have been more appropriate for me to use mapM_ as the difference is that it drops the result.<br /><br /><h3>forever</h3></div><div>As the name suggests, "forever" will execute an IO action forever.</div><div><br /><script src="https://gist.github.com/4461820.js"></script></div><div><br /><h3>forM</h3></div><div>"forM" is pretty much "mapM" only with the parameters shuffled around. It's a little more conducive to passing lambda expressions into it for a very neat and tidy feel.</div><div><br /><script src="https://gist.github.com/4461858.js"></script></div><div><br /></div><div><br /></div><div>That's pretty handy being able to "return" your value from the lambda body back into the assignment.<br /><br /><h3>Getting input from outside</h3><div>Being able to process the STDIN stream is a basic building block for a lot of programs in general. This text processing "duty" is made very simple in Haskell through the use of <a href="http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:getContents">getContents</a> and even easier through <a href="http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:interact">interact</a>.</div><div><br /></div><div>The example program that I've got here uses <a href="http://hackage.haskell.org/packages/archive/base/latest/doc/html/Data-Bits.html#v:xor">`xor`</a>&nbsp;to scramble how a string looks visually. By applying the same function over the scrambled string, we're returned to the original string.</div><div><br /></div><div>Heres the code.</div><div><br /><script src="https://gist.github.com/4466869.js"></script></div><div><br /></div><a href="http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:getContents">getContents</a>&nbsp;works like any other STDIN reader where we might use redirection at the shell to send a text file to it or we might just be entering strings at the console like so.<br /><br /><pre>$ runhaskell scramble.hs <br />Hello<br />M`iij<br />Yes sir-ee bob!<br />\`v%vlw(``%gjg$<br /></pre><br />Not quite "encryption" is it, but it'll do to demonstrate with. Using&nbsp;<a href="http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:interact">interact</a>&nbsp;just cleans up the main function so that it will look like this.<br /><br /><script src="https://gist.github.com/4466880.js"></script> <br /><a href="http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:interact">interact</a>&nbsp;is purpose built for this scenario as this is quite a common task.<br /><br /><h3>Command line parameters</h3><div>The other major source of external interaction to programs is through the command line, passing parameters in. Both <a href="http://hackage.haskell.org/packages/archive/base/latest/doc/html/System-Environment.html#v:getProgName">getProgName</a> and <a href="http://hackage.haskell.org/packages/archive/base/latest/doc/html/System-Environment.html#v:getArgs">getArgs</a> will put you on par with any other environment looking like this.</div><div><br /><script src="https://gist.github.com/4467008.js"></script></div><div><br /></div><br />That's it for IO. I'm going to try and apply this knowledge into some of my projects.</div><div><br /></div></div>
<h2>Comments</h2>
<div class='comments'>
</div>
