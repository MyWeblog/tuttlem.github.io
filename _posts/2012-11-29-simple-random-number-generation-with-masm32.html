---
layout: post
title: Simple random number generation with MASM32
date: 2012-11-29
comments: false
---

<h1>{{ page.title }}</h1>
<div class='post'>
Here's a little tid-bit that I'd like to make note of. In a previous MASM32 windows development tutorial, I needed a random number generator and was able to dig this one up from the archivies.<br /><div><br /></div><div>First of all, you need to make sure we're using the 586 instruction set - at least!</div><div><br /><script src="https://gist.github.com/4164886.js?file=gistfile1.asm"></script></div><div><br /></div><div>Shortly, it will become clear why we need the 586 instruction set.<br /><br />To support the random number generator, we need a bit of state in the shape of two double-words.<br /><br /><script src="https://gist.github.com/4164897.js?file=gistfile1.asm"></script> <br /><br /></div><div>These two variables allow the random number generator to know where it's up to for the next iteration. Changing the initial seed of course will change the sequence of random values that are produced by this routine.<br /><br />The actual function that produces the random number look like this:<br /><br /><script src="https://gist.github.com/4164970.js?file=gistfile1.asm"></script> <br />There it is. That first instruction <a href="http://ref.x86asm.net/coder32-abc.html#R">RDTSC</a>&nbsp;is what we need to turn the 586 instruction set on for. This&nbsp;mnemonic stands for&nbsp;&nbsp;Read Time-Stamp Counter. It will take the number of cycles since the machine has been reset and put this count into the EDX:EAX pair (as the time stamp counter is a 64bit value).<br /><br />From there some calculations are performed to ensure the consistency of state between random value retrieves and also capping to the requested range.<br /><br />Simple and it works too!</div></div>
<h2>Comments</h2>
<div class='comments'>
</div>
