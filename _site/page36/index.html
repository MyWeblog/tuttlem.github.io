<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Cogs and Levers &middot; A blog full of technical stuff
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>A place for thoughts, ideas, tutorials and bookmarks. My brain can only hold so much, you know.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    

    <a class="sidebar-nav-item" href="https://github.com/tuttlem/tuttlem.github.io">GitHub</a>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2014. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <label for="sidebar-checkbox" class="sidebar-toggle"></label>

          <h3 class="masthead-title">
            <a href="/" title="Home">Cogs and Levers</a>
            <small>A blog full of technical stuff</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2012/11/25/using-the-gnu-debugger/">
        Using the GNU Debugger
      </a>
    </h1>

    <span class="post-date">25 Nov 2012</span>

    <h1>Using the GNU Debugger</h1>
<div class='post'>
Bundled with the GNU toolset is a full featured debugger in GDB. This blog post aims to be a cheatsheet to get yourself around this tool quickly.<br /><br /><h3>The example program</h3><div><br /><pre class="brush:c;">int main(int argc, char *argv[]) {<br />  /* some local variables */<br />  int x = 1, y = 2, z = 0;<br />  <br />  /* something that will go bad */<br />  int ans = x / z;<br /><br />  return 0;<br />}<br /></pre></div><h3>Compile your code with debug info</h3><div>You need to use the "-g" switch with GCC in order to compile debug symbols. This helps the feedback that GDB will give you a great deal.</div><div><br /><pre class="brush:shell;">gcc -g test.c -o test<br /></pre><h3>Loading your program into the debugger</h3></div><div>So, in our example above the name of our executable would be "test". So, we just tell gdb to load test by passing it in.</div><div><br /><pre class="brush:shell;">gdb test<br /></pre><br />You can even start gdb with a text user interface, so I've just discovered.<br /><br /><pre class="brush:shell;" style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;">gdb test -tui</pre><br />It looks like this - not bad, eh?<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-6Zx3N1_lUdg/ULHS7XhkRaI/AAAAAAAAAhg/oS9iA9-Jl1c/s1600/Screenshot+-+251112+-+18:11:48.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="276" src="http://2.bp.blogspot.com/-6Zx3N1_lUdg/ULHS7XhkRaI/AAAAAAAAAhg/oS9iA9-Jl1c/s400/Screenshot+-+251112+-+18:11:48.png" width="400" /></a></div><br /><br /></div>Now we instruct gdb that we'd like to run the application<br /><br /><pre class="brush:plain;">(gdb) run<br />Starting program: /home/michael/Development/gdb-tute/test <br /><br />Program received signal SIGFPE, Arithmetic exception.<br />0x00000000004004c3 in main (argc=1, argv=0x7fffffffe4d8) at test.c:9<br />9    ans = x / z;<br /></pre><br />So you can see here that dividing by zero wasn't the best career move for this program. But It nicely let us know that there was an arithmetic exception on line 9!<br /><br /><h3>Examining data</h3>To get just the call stack information, we issue the "backtrace" instruction<br /><br /><pre class="brush:plain;">(gdb) backtrace<br />#0  0x00000000004004c3 in main (argc=1, argv=0x7fffffffe4d8) at test.c:9<br /></pre><br />Examining data with print. We can view the value of variables by passing them to the print statement.<br /><br /><pre class="brush:plain;">(gdb) print x<br />$1 = 1<br />(gdb) print y<br />$2 = 2<br />(gdb) print z<br />$3 = 0<br /></pre><br />Print also supports printf style specifiers. Examining data at an address. We can view the value of data at a memory location by using the "x" command.<br /><br /><pre class="brush:plain;">(gdb) print &amp;z<br />$4 = (int *) 0x7fffffffe3e8<br />(gdb) x 0x7fffffffe3e8<br />0x7fffffffe3e8: 0x00000000</pre><pre class="brush:plain;"></pre><br />Setting variables while attached is done with "set". We can stop the error in the program at runtime using this mixed with a breakpoint.<br /><br /><pre class="brush:plain;">Breakpoint 1, main (argc=1, argv=0x7fffffffe4d8) at test.c:6<br />6    int x = 1, y = 2, z = 0;<br />(gdb) next<br />7    int ans = 0;<br />(gdb) set (z = 5)<br />(gdb) print z<br />$1 = 5</pre><h3>Working with breakpoints</h3>To set a breakpoint in gdb, just pass the name of what you'd like to break on to the "break" command.<br /><br /><pre class="brush:plain;">(gdb) break main<br />Breakpoint 1 at 0x40049f: file test.c, line 6.<br />(gdb) run<br />Starting program: /home/michael/Development/gdb-tute/test <br /><br />Breakpoint 1, main (argc=1, argv=0x7fffffffe4d8) at test.c:6<br />6    int x = 1, y = 2, z = 0;<br /></pre><br />You can set a breakpoint at a specific source code line number:<br /><br /><pre class="brush:plain;">(gdb) break 7<br />Breakpoint 1 at 0x4004b4: file test.c, line 7.<br /></pre><br />Finally, you can make a breakpoint using a combination of source code file name and line location:<br /><br /><pre class="brush:plain;">(gdb) break test.c:7<br />Breakpoint 3 at 0x4004b4: file test.c, line 7.<br /></pre><br />View your existing breakpoints with "info breakpoints"<br /><br /><pre class="brush:plain;">(gdb) info breakpoints<br />Num     Type           Disp Enb Address            What<br />3       breakpoint     keep y   0x00000000004004b4 in main at test.c:7<br /></pre><br />You can clear any set breakpoint with "clear".<br /><br /><pre class="brush:plain;">(gdb) clear main<br />Deleted breakpoint 1<br /></pre><br />You can step into code by issuing the step command  <br /><pre class="brush:shell;">(gdb) step<br />7    int ans = 0;<br />(gdb) <br />9    ans = x / z;<br />(gdb) <br /></pre><pre class="brush:shell;">Program received signal SIGFPE, Arithmetic exception.<br />0x00000000004004c3 in main (argc=1, argv=0x7fffffffe4d8) at test.c:9<br />9    ans = x / z;<br /></pre><br />You step over code by issuing "next". Its usage is the same as "step".<br /><br />That's all for now. As I come across other useful bits from GDB, I'll certainly post them here. The items above have been lifesavers for me from time to time<br /><br /></div>
<h2>Comments</h2>
<div class='comments'>
</div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2012/11/25/unix-ipc-working-with-signals/">
        Unix Ipc Working With Signals
      </a>
    </h1>

    <span class="post-date">25 Nov 2012</span>

    <h1>Unix Ipc Working With Signals</h1>
<div class='post'>
Incoming messages to your process can come in the form of a signal. Signals are standard message packets that the operating system will use to tell your process something about the environment.<br /><br />This snippet will show you show to setup a signal handler in your program.<br /><br /><pre class="brush:c;">/** The signal handler */<br />void sigint_handler(int sig) {<br />	/* do something interesting with the sigint here */<br />}<br /><br />int main(void) {<br /><br />	struct sigaction sa;<br /><br />	/* fill out the signal structure */<br />	sa.sa_handler = sigint_handler;<br />	sa.sa_flags   = 0;<br />	sigemptyset(&amp;sa.sa_mask);<br /><br />	/* assign it to the appropriate signal */<br />	sigaction(SIGINT, &amp;sa, NULL);<br /><br />	/* do other stuff here, sigint will be handled */<br />	<br />}<br /></pre><br />Further reading<br /><br /><a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?sigaction+2">The sigaction system call</a><br /><a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?signal+2">The signal system call</a><br /><a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?raise">The raise system call</a><br /><a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?kill+2">The kill system call</a></div>
<h2>Comments</h2>
<div class='comments'>
</div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2012/11/25/unix-ipc-unix-sockets/">
        Unix Ipc Unix Sockets
      </a>
    </h1>

    <span class="post-date">25 Nov 2012</span>

    <h1>Unix Ipc Unix Sockets</h1>
<div class='post'>
Unix sockets talk locally on the machine. Their operation is very similar to standard socket operations (as they are the same in every way). This snippet will show you a server and client.<br /><br /><pre class="brush:c;">int s, s2, t, len;<br />struct sockaddr_un local, remote;<br />char str[100];<br /><br />/* --- as a server --- */<br /><br />/* create the socket to serve on */<br />s = socket(AF_UNIX, SOCK_STREAM, 0);<br /><br />/* fill out the address struct to listen on */<br />local.sun_family = AF_UNIX;<br />strcpy(local.sun_path, SOCK_PATH);<br />unlink(local.sun_path);<br />len = strlen(local.sun_path) + sizeof(local.sun_family);<br /><br />/* bind the socket to this name */<br />bind(s, (struct sockaddr *)&amp;local, len);<br />/* listen on this socket */<br />listen(s, 5);<br />/* accept any incoming connection */<br />s2 = accept(s, (struct sockaddr *)&amp;remote, &amp;t));<br />/* receive some data */<br />n = recv(s2, str, 100, 0);<br />/* close the client */<br />close(s2);<br /><br /><br />/* --- as a client --- */<br /><br />/* create a socket to connect on */<br />s = socket(AF_UNIX, SOCK_STREAM, 0);<br /><br />/* fill out the address struct to connect to */<br />remote.sun_family = AF_UNIX;<br />strcpy(remote.sun_path, SOCK_PATH);<br />len = strlen(remote.sun_path) + sizeof(remote.sun_family);<br /><br />/* connect on this socket */<br />connect(s, (struct sockaddr *)&amp;remote, len);<br /><br />/* send some data */<br />send(s, str, strlen(str), 0);<br />/* close the socket */<br />close(s);<br /></pre><br />Further reading<br /><br /><a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?socket">The socket system call</a><br /><a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?bind+2">The bind system call</a><br /><a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?listen+2">The listen system call</a><br /><a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?accept+2">The accept system call</a><br /><a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?connect+2">The connect system call</a><br /><a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?send+2">The send system call</a><br /><a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?recv+2">The recv system call</a></div>
<h2>Comments</h2>
<div class='comments'>
</div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2012/11/25/unix-ipc-shared-memory/">
        Unix Ipc Shared Memory
      </a>
    </h1>

    <span class="post-date">25 Nov 2012</span>

    <h1>Unix Ipc Shared Memory</h1>
<div class='post'>
Shared memory allows multiple processes to view, modify and control shared segments of memory. This snippet will show you how to obtain a pointer to some shared memory and then release the pointer.<br /><br /><pre class="brush:c;">key_t key;<br />int shmid;<br /><br />/* get an ipc key */<br />key = ftok("filename", 'R');<br /><br />/* connect to the segment */<br />shmid = shmget(key, SHM_SIZE, 0644 | IPC_CREAT);<br /><br />/* attach to the segment */<br />data = shmat(shmid, (void *)0, 0);<br /><br />/* perform writes and reads on the "data" pointer */<br /><br />/* detach from the segment */<br />shmdt(data);<br /></pre><br />Further reading<br /><br /><a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?shmget">The shmget system call</a><br /><a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?shmat">The shmat system call</a><br /><a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?shmdt">The shmdt system call</a><br /><br /></div>
<h2>Comments</h2>
<div class='comments'>
</div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2012/11/25/unix-ipc-semaphores/">
        Unix Ipc Semaphores
      </a>
    </h1>

    <span class="post-date">25 Nov 2012</span>

    <h1>Unix Ipc Semaphores</h1>
<div class='post'>
Semaphores can simplify access to shared resources. The following snippet will show you how to create a semaphore set and destroy it.<br /><br /><pre class="brush:c;">key_t key;<br />int semid;<br /><br />/* get an IPC key */<br />key = ftok("filename", 'E');<br />/* create the new semaphore set */<br />semid = semget(key, 10, 0666 | IPC_CREAT);<br /><br /><br />/* destroy the semaphore */<br />semctl(semid, 0, IPC_RMID);<br /></pre><br />Further reading<br /><br /><a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?semget">The semget system call</a><br /><a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?semctl">The semctl system call</a></div>
<h2>Comments</h2>
<div class='comments'>
</div>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page37">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page35">Newer</a>
    
  
</div>
      </div>
    </div>

  </body>
</html>
