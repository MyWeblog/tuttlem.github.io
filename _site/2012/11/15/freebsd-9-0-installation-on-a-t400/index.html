<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      FreeBSD 9.0 installation on a T400 &middot; Cogs and Levers
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>A place for thoughts, ideas, tutorials and bookmarks. My brain can only hold so much, you know.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    

    <a class="sidebar-nav-item" href="https://github.com/tuttlem/tuttlem.github.io">GitHub</a>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2014. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <label for="sidebar-checkbox" class="sidebar-toggle"></label>

          <h3 class="masthead-title">
            <a href="/" title="Home">Cogs and Levers</a>
            <small>A blog full of technical stuff</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">FreeBSD 9.0 installation on a T400</h1>
  <span class="post-date">15 Nov 2012</span>
  <p>From time to time, FreeBSD has made its way onto my T400. Each time I do it, I never jot down what I did to get it to &quot;work&quot;. Here&#39;s just a few thoughts and basic guide for installing FreeBSD RELEASE-9.0 on a Lenovo ThinkPad T400.</p>

<h3 id="bios">BIOS</h3>

<p>The T400&#39;s graphics mode needs to be switched from &quot;Discreet&quot; back to &quot;Integrated&quot;, otherwise the BSD installation process just continually reboots. The laptop will now allow a standard installation to be performed.</p>

<h3 id="post-installation">Post Installation</h3>

<p>First things first. Stop the PC Speaker barking at you when you do something questionable (disable by adding this to <em>/etc/sysctl.conf</em>)</p>

<div class="highlight"><pre><code class="text">hw.syscons.bell=0</code></pre></div>

<p>Some switches required for connection resilience need to be applied to the WiFi configuration (fix by commenting these lines from <em>/etc/wpa_supplicant.conf</em>)  </p>

<div class="highlight"><pre><code class="text"># eapol_version=2  
# ap_scan=1  
# fast_reauth=1</code></pre></div>

<p>WiFi network entry should look as follows  </p>

<div class="highlight"><pre><code class="text">network={  
    ssid=&quot;tuttle&quot;  
    key_mgmt=WPA-PSK  
    psk=&quot;secret-in-here&quot;
}</code></pre></div>

<p>Add the full hostname to <em>/etc/rc.conf</em>  </p>

<div class="highlight"><pre><code class="text">hostname=&quot;thor.local&quot;</code></pre></div>

<p>Get the proc filesystem mounted at boot by adding the following line to <em>/etc/fstab</em>  </p>

<div class="highlight"><pre><code class="text">proc   /proc  procfs  rw  0   0</code></pre></div>

<h3 id="organising-the-ports-collection">Organising the ports collection</h3>

<p>In the interest of making the ports collection as &quot;fresh&quot; as possible, it&#39;s best to remove the installed version and pull down the latest version over the web.</p>

<p>Remove the existing ports collection</p>

<div class="highlight"><pre><code class="bash"><span class="nb">cd</span> /usr/ports
rm -Rf *</code></pre></div>

<p>Refresh the ports collection from an australian mirror. You can find full instructions <a href="http://www.freebsd.org/doc/handbook/ports-using.html">here</a> on this.   <strong>Fetch</strong> the collection into /var/db/portsnap <strong>Extract</strong> the collection into /usr/ports    </p>

<div class="highlight"><pre><code class="bash">portsnap fetch
portsnap extract</code></pre></div>

<p>From now on, to refresh ports just use the following command </p>

<div class="highlight"><pre><code class="bash">portsnap update</code></pre></div>

<h3 id="installation">Installation</h3>

<p>Any port needed for installation is done with the following commands  </p>

<div class="highlight"><pre><code class="bash"><span class="nb">cd</span> /usr/ports/path/to/port  
make install clean</code></pre></div>

<p><strong>bash</strong> (<em>/usr/ports/shells/bash</em>)  </p>

<p>Set bash as the default shell for users by running the following  </p>

<div class="highlight"><pre><code class="bash">pw usermod user_name -s /path/to/bash</code></pre></div>

<p><strong>sudo</strong> (<em>/usr/ports/security/sudo</em>)  </p>

<p>Setup user groups who can sudo by editing the config  </p>

<div class="highlight"><pre><code class="bash">visudo -f /usr/local/etc/sudoers</code></pre></div>

<p>Uncomment the line allowing the wheel group  </p>

<div class="highlight"><pre><code class="text">%wheel ALL=(ALL) ALL</code></pre></div>

<p>Add users who want to sudo to the wheel group  </p>

<div class="highlight"><pre><code class="bash">pw usermod user_name -G wheel</code></pre></div>

<p>Other pieces of software to make your environment feel more like home</p>

<p><strong>vim</strong> (<em>/usr/ports/editors/vim-lite</em>) <br />
<strong>git</strong> (<em>/usr/ports/devel/git</em>)  <br />
<strong>xorg</strong> (<em>/usr/ports/x11/xorg</em>)  <br />
<strong>xfce</strong> (<em>/usr/ports/wm/xfce4</em>)  <br />
<strong>gnome-keyring</strong> (<em>/usr/ports/security/gnome-keyring</em>)  <br />
<strong>gnome-power-manager</strong> (<em>/usr/ports/sysutils/gnome-power-manager</em>)  <br />
<strong>chrome</strong> (<em>/usr/ports/www/chromium</em>)  <br />
<strong>pidgin</strong> (<em>/usr/ports/net-im/pidgin</em>)  <br />
<strong>irssi</strong> (<em>/usr/ports/irc/irssi</em>)  <br />
<strong>evince</strong> (<em>/usr/ports/graphics/evince</em>) <br /></p>

<h3 id="preferences">Preferences</h3>

<p>Set colourised output on ls by adding the following line to <em>~/.bash_profile</em> </p>

<div class="highlight"><pre><code class="bash"><span class="nb">alias </span><span class="nv">ls</span><span class="o">=</span><span class="s1">&#39;ls -G&#39;</span></code></pre></div>

<p>Get bash_profile to execute bashrc if it exists by adding the following line towards the top to <em>bash_profile</em> </p>

<div class="highlight"><pre><code class="bash"><span class="nb">test</span> -f ~/.bashrc <span class="o">&amp;&amp;</span> . ~/.bashrc</code></pre></div>

<p><strong>dbus</strong> and <strong>hald</strong> need to be started at boot time if a mouse/keyboard is going to be used within X. To get these to start, add the following lines to the /etc/rc.conf file  </p>

<div class="highlight"><pre><code class="text">dbus_enable=&quot;YES&quot;
hald_enable=&quot;YES&quot;</code></pre></div>

<p>Both of the above config lines can be removed if using a login manager (like <strong>gdm</strong>). All the needs to be added in this scenario is  </p>

<div class="highlight"><pre><code class="text">gnome_enable=&quot;YES&quot;</code></pre></div>

<p>Automatically mount any samba shares at boot by adding lines like the following to <em>/etc/fstab</em> </span></p>

<div class="highlight"><pre><code class="text">&gt;&gt; //user@server/share  /mountpoint  smbfs  rw,-N,-Iserver  0  0</code></pre></div>

<p>With -N specified in the above fstab entry, any secrets needed to connect to the share need to be put into the <em>~/.nsmbrc</em> file and should look as follows  </p>

<div class="highlight"><pre><code class="text">[SERVER:USER]  
password=secret</code></pre></div>

<p><strong>Tread with caution here:</strong> I&#39;ve just rolled back authentication for the samba shares as FreeBSD&#39;s mount_smbfs doesn&#39;t contain a _netdev option which will delay mounting the remote share until the network is available. Not being able to do this makes the BSD boot fail with authentication errors.  </p>

<h3 id="shutdown">Shutdown</h3>

<div class="highlight"><pre><code class="bash">sudo shutdown -h now</code></pre></div>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2014/03/25/assembly-syntax-intel-at-t/">
            Assembly Syntax Intel At T
            <small>25 Mar 2014</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2014/03/24/xargs-i/">
            xargs -i
            <small>24 Mar 2014</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2014/03/19/a-quick-lap-with-mvar/">
            A Quick Lap with MVar
            <small>19 Mar 2014</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

      </div>
    </div>

  </body>
</html>
