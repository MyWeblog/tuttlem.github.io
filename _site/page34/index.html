<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Cogs and Levers &middot; A blog full of technical stuff
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>A place for thoughts, ideas, tutorials and bookmarks. My brain can only hold so much, you know.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    

    <a class="sidebar-nav-item" href="https://github.com/tuttlem/tuttlem.github.io">GitHub</a>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2014. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <label for="sidebar-checkbox" class="sidebar-toggle"></label>

          <h3 class="masthead-title">
            <a href="/" title="Home">Cogs and Levers</a>
            <small>A blog full of technical stuff</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2012/11/29/simple-random-number-generation-with-masm32/">
        Simple random number generation with MASM32
      </a>
    </h1>

    <span class="post-date">29 Nov 2012</span>

    <h1>Simple random number generation with MASM32</h1>
<div class='post'>
Here's a little tid-bit that I'd like to make note of. In a previous MASM32 windows development tutorial, I needed a random number generator and was able to dig this one up from the archivies.<br /><div><br /></div><div>First of all, you need to make sure we're using the 586 instruction set - at least!</div><div><br /><script src="https://gist.github.com/4164886.js?file=gistfile1.asm"></script></div><div><br /></div><div>Shortly, it will become clear why we need the 586 instruction set.<br /><br />To support the random number generator, we need a bit of state in the shape of two double-words.<br /><br /><script src="https://gist.github.com/4164897.js?file=gistfile1.asm"></script> <br /><br /></div><div>These two variables allow the random number generator to know where it's up to for the next iteration. Changing the initial seed of course will change the sequence of random values that are produced by this routine.<br /><br />The actual function that produces the random number look like this:<br /><br /><script src="https://gist.github.com/4164970.js?file=gistfile1.asm"></script> <br />There it is. That first instruction <a href="http://ref.x86asm.net/coder32-abc.html#R">RDTSC</a>&nbsp;is what we need to turn the 586 instruction set on for. This&nbsp;mnemonic stands for&nbsp;&nbsp;Read Time-Stamp Counter. It will take the number of cycles since the machine has been reset and put this count into the EDX:EAX pair (as the time stamp counter is a 64bit value).<br /><br />From there some calculations are performed to ensure the consistency of state between random value retrieves and also capping to the requested range.<br /><br />Simple and it works too!</div></div>
<h2>Comments</h2>
<div class='comments'>
</div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2012/11/29/mode-x-plus-some/">
        Mode X.. plus some!
      </a>
    </h1>

    <span class="post-date">29 Nov 2012</span>

    <h1>Mode X.. plus some!</h1>
<div class='post'>
So, not much of tutorial here - just a neat layout of setup code for a few mode X modes I've come across now and then.<br /><br />First of all, just some formalities. Setting Mode X tweaks to the VGA is a massive port-out exercise. Creating the following macro cut down on my code heaps.<br /><br /><script src="https://gist.github.com/4168905.js?file=gistfile1.asm"></script> <br />So you can see, &nbsp;it just gives sending a byte out to a port a bit of syntactical sugar in assembly language. Easy.<br /><br />The only other piece of formality is, you must have set the video display into MCGA (mode 13) first:<br /><br /><script src="https://gist.github.com/4168969.js?file=gistfile1.asm"></script> <br />On to the modes.<br /><br /><script src="https://gist.github.com/4168909.js?file=gistfile1.asm"></script> <script src="https://gist.github.com/4168920.js?file=gistfile1.asm"></script> <script src="https://gist.github.com/4168932.js?file=gistfile1.asm"></script> <script src="https://gist.github.com/4168936.js?file=gistfile1.asm"></script> <script src="https://gist.github.com/4168939.js?file=gistfile1.asm"></script> <script src="https://gist.github.com/4168949.js?file=gistfile1.asm"></script> <script src="https://gist.github.com/4168963.js?file=gistfile1.asm"></script> <br /><br />I will have an update to this post. There are some nuances that I'd much prefer explain to you with a couple of nice code blocks rather than how I'm just going to throw it into the page.<br /><br />These chunks will be helpful in page selection and optimizing page draws to multiple pages at once.<br /><br /><br /><pre class="brush:plain;"> ; setting a page<br /> ; activeOffset = vgapage + (page * pageSize / 4);<br /> <br /> ; enable all planes<br /> ; outp 03c4h, 02h<br /> ; outp 03c5h, 0fh<br /></pre><br />Some really good references on this topic are<br /><br />Mode X on Wikipedia<br /><a href="http://en.wikipedia.org/wiki/Mode_X">http://en.wikipedia.org/wiki/Mode_X</a><br /><br />Bob Pendleton's Mode X Tutorial<br /><a href="http://www.gameprogrammer.com/3-tweak.html">http://www.gameprogrammer.com/3-tweak.html</a> <br /><br />Well, that's it for now.</div>
<h2>Comments</h2>
<div class='comments'>
</div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2012/11/27/offscreen-mesa3d/">
        Offscreen Mesa3D
      </a>
    </h1>

    <span class="post-date">27 Nov 2012</span>

    <h1>Offscreen Mesa3D</h1>
<div class='post'>
As a quick bookmark, this part of the Mesa3D project: <a href="http://www.mesa3d.org/osmesa.html">Off-screen Rendering</a>&nbsp;looks like it might be a viable option for some of the lower-end hardware I've come across lately.<br /><br />Bisqwit seems to have made pretty decent use of it in one of his videos here<br /><br /><br /><iframe width="420" height="315" src="http://www.youtube.com/embed/vkUwT9U1GzA" frameborder="0" allowfullscreen></iframe><br />Interesting.</div>
<h2>Comments</h2>
<div class='comments'>
</div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2012/11/27/music-calculators-big-snakes/">
        Music, Calculators & Big Snakes
      </a>
    </h1>

    <span class="post-date">27 Nov 2012</span>

    <h1>Music, Calculators & Big Snakes</h1>
<div class='post'>
<h3>Introduction</h3><div>I play a lot of music. I mean <u style="font-weight: bold;">a lot</u>&nbsp;of music. Guitar, Bass, Piano, Drums, Harp -- what ever I can get my hands on, I'll give it a go. So, the neurons in charge of keeping my technical side in check may have made their way into the creative side of my brain.</div><div><br /></div><div>The net result was me creating a project that mashes mathematics, data analysis and music theory into a few classed called <a href="https://github.com/tuttlem/musica">musica</a>.</div><div><br /></div><h3>So what?</h3><div>Yeah, basically.. But, I am who I am - so it' more of a matter of "why not?".</div><div><br /></div><div>I'd previously tried building a Ruby on Rails application to give me graphical representations of musically related elements on screen. A scale is a pattern of intervals realised once a root note is put in place. This scale can then be harmonised at every step of the scale by employing every second note from the specific step. How complex these harmonised chords are will depend on how many steps you include in the chords that you build.</div><div><br /></div><div>The most interesting part of this library, I think, is its distinct lack of database. It has made the code quite verbose in parts but I intend to fix this, even if it does mean employing an intermediary database at a later stage.<br /><br /><h3>What can it do?</h3></div><div>The major, harmonic &amp; melodic minor scales (and all of their modes) are statically provisioned. You can use these in code to perform operations like voicing a scale when used in conjunction with a Note object.</div><div><br /></div><div>Immediately, we can get information about notes:<br /><br /><script src="https://gist.github.com/4153854.js?file=gistfile1.py"></script> Information about scales:<br /><script src="https://gist.github.com/4153859.js?file=gistfile1.py"></script> Voicing a scale (in this instance voicing Ionian (major) over C) <br /><script src="https://gist.github.com/4153871.js?file=gistfile1.py"></script></div><div><br /></div><div><h3>Still so much to do ...</h3></div><div>Still, we need to get chords harmonising from these voiced scales. These are just patterns after all. An intelligent chord builder would also be of value I think. Something where we don't have to explicitly map out chord names to interval sets statically. Just knowing that a root, major third and perfect fifth are a major chord.</div><div><br /></div><div>That'd be a cool calculator, I think.</div><div><br /></div><div>If your interested, the git repo for this library is <a href="https://github.com/tuttlem/musica">here</a>.</div></div>
<h2>Comments</h2>
<div class='comments'>
</div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2012/11/27/calling-assembly-from-c-64-bit/">
        Calling Assembly from C (64 bit)
      </a>
    </h1>

    <span class="post-date">27 Nov 2012</span>

    <h1>Calling Assembly from C (64 bit)</h1>
<div class='post'>
In a <a href="http://cogsandlevers.blogspot.com.au/2012/11/calling-assembly-from-c-32-bit.html">previous blog post</a>, I spoke about calling assembly language routines from C in 32-bit land. In this post, I aim to show you the same technique only this time using a 64 bit architecture.<br /><br />I'll be using the same technology stack as last time with <a href="http://www.nasm.us/">NASM </a>as my assembler and <a href="http://gcc.gnu.org/">GCC</a> as my C compiler. The code snippets that you'll see in this post have been compiled and linked together on the linux platform.<br /><br />Alright then. On with the code!<br /><br />The C-code is not different from the 32-bit version as mentioned in my previous post. Now <b>that's</b>&nbsp;portability for you!<br /><br /><script src="https://gist.github.com/4142080.js?file=gistfile1.c"></script> The assembly language module has changed somewhat though.<br /><br /><script src="https://gist.github.com/4151995.js?file=gistfile1.asm"></script> <br />Immediately you can see that a new set of registers are being used and the stack is no longer being used to take parameters in from external calls.<br /><br />The change in calling convention can be studied in further detail <a href="http://www.x86-64.org/documentation/abi.pdf">here</a>, however it's just important to mention this:<br /><blockquote class="tr_bq"><blockquote class="tr_bq">Once arguments are classified, the registers get assigned (in left-to-right order) for passing as follows:</blockquote><blockquote class="tr_bq">If the class is MEMORY, pass the argument on the stack.</blockquote><blockquote class="tr_bq">If the class is INTEGER, the next available register of the sequence %rdi, %rsi, %rdx, %rcx, %r8 and %r9 is used</blockquote></blockquote>So, the first argument is passed in RDI and the second in RSI. The return value remains the same being passed back to the caller using the accumulator register (RAX in 64-bit land). There are many resources to read up on when it comes to the 64 bit architecture; <a href="http://www.intel.com/content/www/us/en/architecture-and-technology/microarchitecture/intel-64-architecture-general.html">Intel</a>&nbsp;and <a href="http://en.wikipedia.org/wiki/X86-64">Wikipedia</a>&nbsp;are both excellent resources.<br /><br />Finally, when it comes to building these files together, it's (again) very similar to its 32bit counterpart.<br /><br /><script src="https://gist.github.com/4152023.js?file=gistfile1.sh"></script> We're done!<br /><br /><br /></div>
<h2>Comments</h2>
<div class='comments'>
</div>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page35">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page33">Newer</a>
    
  
</div>
      </div>
    </div>

  </body>
</html>
