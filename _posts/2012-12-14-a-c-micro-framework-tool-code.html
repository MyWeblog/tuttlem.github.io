---
layout: post
title: A C# Micro-framework: Tool code
date: 2012-12-14
comments: false
---

<h1>{{ page.title }}</h1>
<div class='post'>
The tools are what counts when it comes to frameworks like this. What good is your framework if it's too hard to use? So a design goal would be to allow the developer to get up and running as quickly as possible.<br /><br />In this post, I want to take the most important chunks out of <i style="font-weight: bold;">Dino</i>, our filesystem-change-responding-c#-auto-compiling-web-server-host application to show you the simplicity of the idea. There's also a couple of gems that you might find you'll come back to and research a little more.<br /><br />First up, we need a way to respond to file system events. We want to know when a file is created, when a file is deleted and when a file's contents changes. Too easy, let's employ the <a href="http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.aspx">FileSystemWatcher</a> class from the System.IO namespace.<br /><br /><script src="https://gist.github.com/4285000.js"></script> We've got some event handlers now attached to an object responding to the file types that we care about and when we care about them. We need to be able to serve this functionality over HTTP so we're going to need to embed a web server into our application. <a href="http://msdn.microsoft.com/en-us/library/system.net.httplistener.aspx">HttpListener</a> from the System.Net namespace makes short work of getting this accomplished.<br /><br /><script src="https://gist.github.com/4285007.js"></script> <br />Excellent. So, now we really need to bridge the gap here. We need to get this code compiled and served to client connections.<br /><br />Compiling C# code on the fly is actually a really painless experience. You fire up a <a href="http://msdn.microsoft.com/en-us/library/microsoft.csharp.csharpcodeprovider.aspx">CSharpCodeProvider</a>&nbsp;class, give it some compiler options (just as you would at the shell) through the <a href="http://msdn.microsoft.com/en-us/library/system.codedom.compiler.compilerparameters.aspx">CompilerParameters</a>&nbsp;class and off you go.<br /><br /><script src="https://gist.github.com/4285069.js"></script> <br />We're almost there. We just need to glue the assembly that we're generating onto the end of a http request so that we accomplish the serving of the application. Now this code is the real brains of the application, I think. It needs a-hell-of-a-lot-of work, but it accomplishes what is needed for this prototype.<br /><br />As you read through it, you'll see the deficiencies immediately but it should be pretty inspiring as to what you can load into this one method to make it a full-on application exchange.<br /><br /><script src="https://gist.github.com/4285052.js"></script> <br />... and of course, like any good console application, we signal that we want to get out with Control-C.<br /><br /><script src="https://gist.github.com/4285015.js"></script> <br />You should have a pretty clear idea in your heads now where this is going. It is time to make this a bit more of a fully-featured application though. Having it sit in prototypical form like this is depressing.<br /><br />I'll be back soon with some more progress, hopefully!</div>
<h2>Comments</h2>
<div class='comments'>
</div>
