---
layout: post
title: 64bit ABI Cheatsheet
date: 2013-02-14
comments: false
---

<h1>{{ page.title }}</h1>
<div class='post'>
<h3>Introduction</h3><div>Using a few different articles around the web, I thought it might be a good idea to aggregate all of the information around calling conventions in 64bit land. This could come in handy when wanting to write a cross OS compliant library at the assembly level.</div><div><br /></div><div>This particular article will directly target the assembly programming layer so that topics like C++ name mangling and caller clean-up are removed from its scope.</div><h3>References</h3><div>x86 calling conventions</div><div><a href="http://en.wikipedia.org/wiki/X86_calling_conventions">http://en.wikipedia.org/wiki/X86_calling_conventions</a></div><div><br /></div><div>x86-64.org documentation</div><div><a href="http://www.x86-64.org/documentation/">http://www.x86-64.org/documentation/</a></div><div><br /></div><div>Mac OSX 64 bit Assembly System Calls</div><div><a href="http://thexploit.com/secdev/mac-os-x-64-bit-assembly-system-calls/">http://thexploit.com/secdev/mac-os-x-64-bit-assembly-system-calls/</a></div><div><br /></div><h3>Microsoft</h3><div>Windows will use <b>RCX</b>, <b>RDX</b>, <b>R8 </b>and <b>R9 </b>for the first four integer or pointer arguments. <b>XMM0</b>, <b>XMM1</b>, <b>XMM2 </b>and <b>XMM3 </b>are used for floating point arguments. Additional arguments are passed via the stack (right to left).</div><div><br /></div><div>An integer or pointer return value will be returned in <b>RAX</b>. Floating point return will be in <b>XMM0</b>.</div><div><br /></div><h3>System V</h3><div>System V operating systems will use <b>RDI</b>, <b>RSI</b>, <b>RDX</b>, <b>RCX</b>, <b>R8 </b>and <b>R9</b>. <b>XMM0</b>, <b>XMM1</b>, <b>XMM2</b>, <b>XMM3</b>, <b>XMM4</b>, <b>XMM5</b>, <b>XMM6 </b>and <b>XMM7 </b>will be used to pass floating point parameters. <b>RAX </b>will hold the syscall number. Additional arguments are passed via the stack (right to left).</div><div><br /></div><div>Return values are sent back via <b>RAX</b>.</div><div><br /></div><h3>Syscall Numbers</h3><div>It's interesting to note the structure of the syscall number when it comes time to execute. Looking at <a href="http://www.opensource.apple.com/source/xnu/xnu-792.13.8/osfmk/mach/i386/syscall_sw.h">syscall_sw.h</a>, you'll see that apple machines want a 2 in the higher-order double word such that the "write" syscall, normally passed as 0x04 would be passed as 0x2000004 in OSX.</div><div><br /></div><div>That's it for today. Just a cheat sheet really.</div><div><br /></div></div>
<h2>Comments</h2>
<div class='comments'>
</div>
