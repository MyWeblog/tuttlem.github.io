<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Plasma, plasma, plasma! &middot; Cogs and Levers
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>A place for thoughts, ideas, tutorials and bookmarks. My brain can only hold so much, you know.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    

    <a class="sidebar-nav-item" href="https://github.com/tuttlem/tuttlem.github.io">GitHub</a>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2014. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <label for="sidebar-checkbox" class="sidebar-toggle"></label>

          <h3 class="masthead-title">
            <a href="/" title="Home">Cogs and Levers</a>
            <small>A blog full of technical stuff</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">Plasma, plasma, plasma!</h1>
  <span class="post-date">30 Nov 2012</span>
  <h1>Plasma, plasma, plasma!</h1>
<div class='post'>
Kicking back into old, old, old school mode, I had found another cool effect laying around that seemed to work really well in dosbox. It's a plasma (if you couldn't tell from the title).<br /><br />Plasmas are the cool, blobby sort of shapeless eye-grabbers that are seriously cool and simple.<br /><br />The basic mathematical thory of the plasma is simple.<br /><ul><li>4 state counters for the program track where you're up to overall</li><li>4 state counters per frame render track where you're up to for that frame</li><li>Each pixel is the result of these 4 cosine wave intersections. You can include the x and y counting dimensions to add the 6 intersections.</li></ul>That's it really. There's a little special sauce to make the plasma move and mutate but they really have no bearing over the generation of the effect itself.<br /><br /><h3>Cosine? Easy, I'll just call cosf()!</h3>Well, not quite. This is a demo routine that will entirely written in assembly language (8086 assembly language to be exact) and as such we won't have the luxury of a math library (or math-coprocessor) to do the work of finding out cosine values.<br /><br />So, we must pre-calculate. A small C application gives us all the table pre-calculation we'll need for this application. It's good to keep this application handy to re-pre-calculate this table to taste. If you like a little extra calculation to go into your cos table, that is. Me, I like nerdy numbers. So, according to this cos table, there are 256 degress in a circle (see what I did there) and the top of the cos curve (1.0) is 255 moving through the centre point (0.0) at 127 all the way down to the bottom point (-1.0) at 0.<br /><br />Here's the code to generate that table.<br /><br /> <script src="https://gist.github.com/4172261.js?file=gistfile1.c"></script> <br />Here is the table that is generated when running this code.<br /><br /><pre class="brush:plain;">costab DB 0feh, 0fdh, 0fdh, 0fdh, 0fdh, 0fdh, 0fch, 0fch <br />       DB 0fbh, 0fah, 0fah, 0f9h, 0f8h, 0f7h, 0f6h, 0f5h <br />       DB 0f4h, 0f3h, 0f1h, 0f0h, 0efh, 0edh, 0ebh, 0eah <br />       DB 0e8h, 0e6h, 0e5h, 0e3h, 0e1h, 0dfh, 0ddh, 0dah <br />       DB 0d8h, 0d6h, 0d4h, 0d1h, 0cfh, 0cdh, 0cah, 0c8h <br />       DB 0c5h, 0c2h, 0c0h, 0bdh, 0bah, 0b8h, 0b5h, 0b2h <br />       DB 0afh, 0ach, 0a9h, 0a6h, 0a3h, 0a0h, 09dh, 09ah <br />       DB 097h, 094h, 091h, 08eh, 08bh, 088h, 085h, 082h <br />       DB 07fh, 07bh, 078h, 075h, 072h, 06fh, 06ch, 069h <br />       DB 066h, 063h, 060h, 05dh, 05ah, 057h, 054h, 051h <br />       DB 04eh, 04bh, 048h, 045h, 043h, 040h, 03dh, 03bh <br />       DB 038h, 035h, 033h, 030h, 02eh, 02ch, 029h, 027h <br />       DB 025h, 023h, 020h, 01eh, 01ch, 01ah, 018h, 017h <br />       DB 015h, 013h, 012h, 010h, 00eh, 00dh, 00ch, 00ah <br />       DB 009h, 008h, 007h, 006h, 005h, 004h, 003h, 003h <br />       DB 002h, 001h, 001h, 000h, 000h, 000h, 000h, 000h <br />       DB 000h, 000h, 000h, 000h, 000h, 000h, 001h, 001h <br />       DB 002h, 003h, 003h, 004h, 005h, 006h, 007h, 008h <br />       DB 009h, 00ah, 00ch, 00dh, 00eh, 010h, 012h, 013h <br />       DB 015h, 017h, 018h, 01ah, 01ch, 01eh, 020h, 023h <br />       DB 025h, 027h, 029h, 02ch, 02eh, 030h, 033h, 035h <br />       DB 038h, 03bh, 03dh, 040h, 043h, 045h, 048h, 04bh <br />       DB 04eh, 051h, 054h, 057h, 05ah, 05dh, 060h, 063h <br />       DB 066h, 069h, 06ch, 06fh, 072h, 075h, 078h, 07bh <br />       DB 07eh, 082h, 085h, 088h, 08bh, 08eh, 091h, 094h <br />       DB 097h, 09ah, 09dh, 0a0h, 0a3h, 0a6h, 0a9h, 0ach <br />       DB 0afh, 0b2h, 0b5h, 0b8h, 0bah, 0bdh, 0c0h, 0c2h <br />       DB 0c5h, 0c8h, 0cah, 0cdh, 0cfh, 0d1h, 0d4h, 0d6h <br />       DB 0d8h, 0dah, 0ddh, 0dfh, 0e1h, 0e3h, 0e5h, 0e6h <br />       DB 0e8h, 0eah, 0ebh, 0edh, 0efh, 0f0h, 0f1h, 0f3h <br />       DB 0f4h, 0f5h, 0f6h, 0f7h, 0f8h, 0f9h, 0fah, 0fah <br />       DB 0fbh, 0fch, 0fch, 0fdh, 0fdh, 0fdh, 0fdh, 0fdh<br /></pre><br /><br />Ooooh aaahhh, that's a nerdy cosine table!<br /><br />Now that we've solved all of the world's mathematical problems here, it's on to the effect! Just getting 4 counters to run over this cosine table and intersect with each other can produce a mesmerising result. Without setting a palette (the standard vga palette is a bit: ewwwwww), here's how the effect looks:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-qsvAge9ukJU/ULindu0nksI/AAAAAAAAAhw/uky0JwHqooA/s1600/plasma.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="263" src="http://1.bp.blogspot.com/-qsvAge9ukJU/ULindu0nksI/AAAAAAAAAhw/uky0JwHqooA/s400/plasma.png" width="400" /></a></div><br />Feel like you're at Woodstock yet?<br /><br />So, the effect really spans across two smaller functions, which I've tried to comment as best I can below. Here's drawing a single frame:<br /><br /><br /><script src="https://gist.github.com/4175519.js?file=gistfile1.asm"></script> <br /><br />Drawing a single frame isn't too difficult at all. It's important to remember that es:[di] is pointing to the vga buffer to draw to where as ds:[si] is pointing at the cosine table. We're using bx as a base pointer to offset si such that it acts as our array index. Neat-O!<br /><br />Between frame draws, we need to make the plasma MOVE!!.. This is just some simple additions or subtractions. Using random values adds a sense of entropy to the process making the plasma move in an almost unpredictable way. It's a little more organic this way.<br /><br />I haven't done it this way though. The code you'll see below moves the plasma by fixed amounts per frame. Still gives it some movement.<br /><br /><br /><script src="https://gist.github.com/4175531.js?file=gistfile1.asm"></script> Wrapping those two calls in a loop that waits for a key to be pressed is all you should need to draw a plasma to the screen.<br /><br />Things for you to do:<br /><br /><br /><ul><li>Change the cosine table generation to produce a more interesting cosine curve</li><li>Apply a palette to take the 60's-ness out of the default palette</li><li>Apple a palette that you can cycle through (like 1024 or 2048 entries in size) so that the palette (and therefore the plasma) will morph colour as frames progress</li><li>Add randomness.</li></ul><div>Have fun.</div><br /><br /><br /></div>
<h2>Comments</h2>
<div class='comments'>
</div>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2014/03/25/assembly-syntax-intel-at-t/">
            Assembly Syntax Intel At T
            <small>25 Mar 2014</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2014/03/24/xargs-i/">
            xargs -i
            <small>24 Mar 2014</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2014/03/19/a-quick-lap-with-mvar/">
            A Quick Lap with MVar
            <small>19 Mar 2014</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

      </div>
    </div>

  </body>
</html>
