<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Cogs and Levers &middot; A blog full of technical stuff
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>A place for thoughts, ideas, tutorials and bookmarks. My brain can only hold so much, you know.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    

    <a class="sidebar-nav-item" href="https://github.com/tuttlem/tuttlem.github.io">GitHub</a>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2014. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <label for="sidebar-checkbox" class="sidebar-toggle"></label>

          <h3 class="masthead-title">
            <a href="/" title="Home">Cogs and Levers</a>
            <small>A blog full of technical stuff</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/01/09/hadoop-2-2-2-0-setup-on-debian/">
        Hadoop 2 (2.2.0) setup on Debian
      </a>
    </h1>

    <span class="post-date">09 Jan 2014</span>

    <p>Today&#39;s post will just be a walk through of the steps required to install Hadoop 2 on Debian Linux. Please note that this is for a single node installation only. This guide is heavily based on the Ubuntu instructions found <a href="http://codesfusion.blogspot.com.au/2013/10/setup-hadoop-2x-220-on-ubuntu.html">here</a>.</p>

<h3 id="install-java">Install Java</h3>

<div class="highlight"><pre><code class="bash"><span class="c"># install the java jdk</span>
<span class="nv">$ </span>sudo apt-get install openjdk-7-jdk
 
<span class="c"># make a jdk symlink</span>
<span class="nv">$ </span><span class="nb">cd</span> /usr/lib/jvm
<span class="nv">$ </span>ln -s java-7-openjdk-amd64 jdk
 
<span class="c"># make sure that ssh server is installed</span>
<span class="nv">$ </span>sudo apt-get install openssh-server</code></pre></div>

<h3 id="add-hadoop-users-and-groups">Add Hadoop Users and Groups</h3>

<div class="highlight"><pre><code class="bash"><span class="c"># create a new group for hadoop</span>
<span class="nv">$ </span>sudo addgroup hadoop
 
<span class="c"># create the hduser and put them in the hadoop group</span>
<span class="nv">$ </span>sudo adduser --ingroup hadoop hduser
 
<span class="c"># add them to the sudo group also</span>
<span class="nv">$ </span>sudo adduser hduser sudo</code></pre></div>

<p>Now login as &quot;hduser&quot;.</p>

<h3 id="ssh-certificates">SSH Certificates</h3>

<div class="highlight"><pre><code class="bash"><span class="c"># generate your key</span>
<span class="nv">$ </span>ssh-keygen -t rsa -P <span class="s1">&#39;&#39;</span>
 
<span class="c"># set your public key as authorized</span>
<span class="nv">$ </span>cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys
 
<span class="c"># test out ssh</span>
<span class="nv">$ </span>ssh localhost</code></pre></div>

<h3 id="download-hadoop">Download Hadoop</h3>

<div class="highlight"><pre><code class="bash"><span class="c"># downoad the package</span>
<span class="nv">$ </span><span class="nb">cd</span> ~
<span class="nv">$ </span>wget http://mirror.rackcentral.com.au/apache/hadoop/common/hadoop-2.2.0/hadoop-2.2.0.tar.gz
 
<span class="c"># extract the package</span>
<span class="nv">$ </span>sudo tar vxzf hadoop-2.2.0.tar.gz -C /usr/local
<span class="nv">$ </span><span class="nb">cd</span> /usr/local
<span class="nv">$ </span>sudo mv hadoop-2.2.0 hadoop
 
<span class="c"># get the hduser to take ownership</span>
<span class="nv">$ </span>sudo chown -R hduser:hadoop hadoop</code></pre></div>

<h3 id="setup-environment-variables">Setup Environment Variables</h3>

<p>Add the following lines to your <code>~/.bashrc</code></p>

<div class="highlight"><pre><code class="bash"><span class="c"># Hadoop variables</span>
<span class="nb">export </span><span class="nv">JAVA_HOME</span><span class="o">=</span>/usr/lib/jvm/jdk/
<span class="nb">export </span><span class="nv">HADOOP_INSTALL</span><span class="o">=</span>/usr/local/hadoop
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$HADOOP_INSTALL</span>/bin
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$HADOOP_INSTALL</span>/sbin
<span class="nb">export </span><span class="nv">HADOOP_MAPRED_HOME</span><span class="o">=</span><span class="nv">$HADOOP_INSTALL</span>
<span class="nb">export </span><span class="nv">HADOOP_COMMON_HOME</span><span class="o">=</span><span class="nv">$HADOOP_INSTALL</span>
<span class="nb">export </span><span class="nv">HADOOP_HDFS_HOME</span><span class="o">=</span><span class="nv">$HADOOP_INSTALL</span>
<span class="nb">export </span><span class="nv">YARN_HOME</span><span class="o">=</span><span class="nv">$HADOOP_INSTALL</span></code></pre></div>

<p>Add the following lines to <code>/usr/local/hadoop/etc/hadoop/hadoop-env.sh</code></p>

<div class="highlight"><pre><code class="bash"><span class="c"># modify JAVA_HOME</span>
<span class="nb">export </span><span class="nv">JAVA_HOME</span><span class="o">=</span>/usr/lib/jvm/jdk/</code></pre></div>

<p>Re-login to your machine as hduser, and check the hadoop version.</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>hadoop version</code></pre></div>

<h3 id="configure-hadoop">Configure Hadoop</h3>

<p>Add the following lines into the <code>&lt;configuration&gt;</code> node within <code>/usr/local/hadoop/etc/hadoop/core-site.xml</code></p>

<div class="highlight"><pre><code class="xml"><span class="nt">&lt;property&gt;</span>
   <span class="nt">&lt;name&gt;</span>fs.default.name<span class="nt">&lt;/name&gt;</span>
   <span class="nt">&lt;value&gt;</span>hdfs://localhost:9000<span class="nt">&lt;/value&gt;</span>
<span class="nt">&lt;/property&gt;</span></code></pre></div>

<p>Add the following lines into the <code>&lt;configuration&gt;</code> node within <code>/usr/local/hadoop/etc/hadoop/yarn-site.xml</code></p>

<div class="highlight"><pre><code class="xml"><span class="nt">&lt;property&gt;</span>
   <span class="nt">&lt;name&gt;</span>yarn.nodemanager.aux-services<span class="nt">&lt;/name&gt;</span>
   <span class="nt">&lt;value&gt;</span>mapreduce_shuffle<span class="nt">&lt;/value&gt;</span>
<span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;property&gt;</span>
   <span class="nt">&lt;name&gt;</span>yarn.nodemanager.aux-services.mapreduce.shuffle.class<span class="nt">&lt;/name&gt;</span>
   <span class="nt">&lt;value&gt;</span>org.apache.hadoop.mapred.ShuffleHandler<span class="nt">&lt;/value&gt;</span>
<span class="nt">&lt;/property&gt;</span></code></pre></div>

<p>Make a copy of the mapred-site template file</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>mv mapred-site.xml.template mapred-site.xml
<span class="nv">$ </span>vi mapred-site.xml</code></pre></div>

<p>Add the following lines into the <code>&lt;configuration&gt;</code> node within <code>/usr/local/hadoop/etc/hadoop/mapred-site.xml</code></p>

<div class="highlight"><pre><code class="xml"><span class="nt">&lt;property&gt;</span>
   <span class="nt">&lt;name&gt;</span>mapreduce.framework.name<span class="nt">&lt;/name&gt;</span>
   <span class="nt">&lt;value&gt;</span>yarn<span class="nt">&lt;/value&gt;</span>
<span class="nt">&lt;/property&gt;</span></code></pre></div>

<h3 id="prepare-the-filesystem">Prepare the Filesystem</h3>

<div class="highlight"><pre><code class="bash"><span class="c"># create the physical directories</span>
<span class="nv">$ </span><span class="nb">cd</span> ~
<span class="nv">$ </span>mkdir -p mydata/hdfs/namenode
<span class="nv">$ </span>mkdir -p mydata/hdfs/datanode</code></pre></div>

<p>Add the following lines into the <code>&lt;configuration&gt;</code> node <code>/usr/local/hadoop/etc/hadoop/hdfs-site.xml</code></p>

<div class="highlight"><pre><code class="xml"><span class="nt">&lt;property&gt;</span>
   <span class="nt">&lt;name&gt;</span>dfs.replication<span class="nt">&lt;/name&gt;</span>
   <span class="nt">&lt;value&gt;</span>1<span class="nt">&lt;/value&gt;</span>
 <span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property&gt;</span>
   <span class="nt">&lt;name&gt;</span>dfs.namenode.name.dir<span class="nt">&lt;/name&gt;</span>
   <span class="nt">&lt;value&gt;</span>file:/home/hduser/mydata/hdfs/namenode<span class="nt">&lt;/value&gt;</span>
 <span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property&gt;</span>
   <span class="nt">&lt;name&gt;</span>dfs.datanode.data.dir<span class="nt">&lt;/name&gt;</span>
   <span class="nt">&lt;value&gt;</span>file:/home/hduser/mydata/hdfs/datanode<span class="nt">&lt;/value&gt;</span>
 <span class="nt">&lt;/property&gt;</span></code></pre></div>

<p>Format the namenode</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>hdfs namenode -format</code></pre></div>

<h3 id="start-hadoop">Start Hadoop</h3>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>start-dfs.sh
<span class="nv">$ </span>start-yarn.sh
 
<span class="c"># check that services are running</span>
<span class="nv">$ </span>jps</code></pre></div>

<p>Run the Example</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span><span class="nb">cd</span> /usr/local/hadoop
<span class="nv">$ </span>hadoop jar ./share/hadoop/mapreduce/hadoop-mapreduce-examples-2.2.0.jar pi 2 5</code></pre></div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/01/08/getting-started-with-lua-using-c/">
        Getting started with Lua using C++
      </a>
    </h1>

    <span class="post-date">08 Jan 2014</span>

    <h3 id="introduction">Introduction</h3>

<p><a href="http://www.lua.org/">Lua</a> is a programming language that has seen increased popularity from the game development industry. It&#39;s put to use in the disciplines of providing configuration data all the way through to scripting automated character actions.</p>

<p>In today&#39;s post, I&#39;ll walk you through the setup process of the libraries up to writing your first testing application within a Linux environment.</p>

<h3 id="library-installation">Library Installation</h3>

<p>Before you get downloading and building this library, you&#39;ll just need to ensure that you have a build environment installed and are able to compile. </p>

<p>At the time of writing this article, the <a href="http://www.lua.org/">Lua</a> website had 5.2.3 as their latest release. From their <a href="http://www.lua.org/download.html">downloads</a> page, grab the latest tar.gz archive and extract it onto your machine. Following along with their building instructions, issuing &quot;make linux test&quot; whilst in the extracted folder did the trick. It built Lua ready for me to use. A nice convenience of the make file was the &quot;make local&quot; option. Upon issuing this request, the make system will prepare an installation folder that is suitable for you to use locally (i.e. not installed to the system).</p>

<p>When it comes to downloading the latest versions of libraries, I&#39;ll rarely install these to my system. Rather, I drag them around for each project that needs them so that the project determines its dependencies as opposed to my system.</p>

<p>From here, I prepare a distributable directory of development files that I know that each of my project needs. In the case of Lua, I create the following structure:</p>

<div class="highlight"><pre><code class="text">.
└── lua-5.2.3
    ├── include
    │   ├── lauxlib.h
    │   ├── luaconf.h
    │   ├── lua.h
    │   ├── lua.hpp
    │ └── lualib.h
    └── lib
        ├── liblua.a
        └── lua
            └── 5.2</code></pre></div>

<p>I have all of the development headers available (under the &quot;include&quot; folder) and a static version of the Lua library (under lib).</p>

<h3 id="building-applications">Building applications</h3>

<p>When building Lua applications, you&#39;ll need to specify the libraries and include folders to your compiler so it knows where to find them. For a test application that I&#39;d written, the following command line compiled an application for me without any trouble.</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>g++ -Ilib/lua-5.2.3/include -Llib/lua-5.2.3/lib/ -llua -ldl</code></pre></div>

<p>You can see at the end there, mention of both the &quot;lua&quot; and &quot;dl&quot; libraries.</p>

<h3 id="test-application">Test application</h3>

<p>A very simple test to start will be creating a program that will execute a Lua script, pull out on of its global variables and display it to screen.</p>

<p>Here&#39;s our Lua script:</p>

<div class="highlight"><pre><code class="lua"><span class="n">x</span> <span class="o">=</span> <span class="mi">10</span></code></pre></div>

<p>Pretty simple. We have one variable <code>x</code> set to <code>10</code>. Now here&#39;s the C++ code that we use to read that one variable out and present it to screen.</p>

<div class="highlight"><pre><code class="cpp"><span class="cp">#include &lt;iostream&gt;</span>
<span class="cp">#include &lt;lua.hpp&gt;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
  <span class="c1">// create a new lua context to work with</span>
  <span class="n">lua_State</span> <span class="o">*</span><span class="n">L</span> <span class="o">=</span> <span class="n">luaL_newstate</span><span class="p">();</span>

  <span class="c1">// open any library we may use</span>
  <span class="n">luaL_openlibs</span><span class="p">(</span><span class="n">L</span><span class="p">);</span>

  <span class="c1">// read the Lua script off disk and execute it</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">luaL_dofile</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="s">&quot;test.lua&quot;</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="c1">// handle any errors </span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;unable to load test.lua&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    
  <span class="p">}</span>

  <span class="c1">// put the value of X at the top of the stack</span>
  <span class="n">lua_getglobal</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="s">&quot;x&quot;</span><span class="p">);</span>
  
  <span class="c1">// interpret the value at the top of the stack </span>
  <span class="c1">// as an integer and put it in the variable &quot;val&quot;</span>
  <span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">lua_tointeger</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
  
  <span class="c1">// pop the value of X off the stack</span>
  <span class="n">lua_pop</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

  <span class="c1">// write the value out</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Value of X: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

  <span class="c1">// finish up with the Lua context</span>
  <span class="n">lua_close</span><span class="p">(</span><span class="n">L</span><span class="p">);</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="p">}</span></code></pre></div>

<p>I think that the source code above (paired with the documentation on the Lua website) should make things pretty straight forward.</p>

<p>That&#39;s it for today. This is only scratching the surface on what Lua can do. For my purposes right now, I just need to feed configuration values into programs, this fits the purpose really well.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/01/05/installing-sdl2-on-linux/">
        Installing SDL2 on Linux
      </a>
    </h1>

    <span class="post-date">05 Jan 2014</span>

    <h3 id="introduction">Introduction</h3>

<p><a href="http://www.libsdl.org/download-2.0.php">SDL2</a> was released a little while ago, but still hasn&#39;t made it into the stable repositories of some Linux distributions. After doing a big of digging, it&#39;s not too hard to get this installed yourself - most of the advice offered in this post comes from an answer on the Ubuntu forums <a href="http://askubuntu.com/questions/344512/what-is-the-general-procedure-to-install-development-libraries-in-ubuntu">here</a>.</p>

<p>In today&#39;s post, we&#39;ll install SDL2 on a Debian/Ubuntu style distribution from source.</p>

<h3 id="dependencies">Dependencies</h3>

<p>First thing before we download and compile the SDL2 source is to get some of the dependencies installed on your system. The following install line will put all of the libraries that SDL2 requires:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>sudo apt-get install build-essential xorg-dev libudev-dev libts-dev libgl1-mesa-dev libglu1-mesa-dev libasound2-dev libpulse-dev libopenal-dev libogg-dev libvorbis-dev libaudiofile-dev libpng12-dev libfreetype6-dev libusb-dev libdbus-1-dev zlib1g-dev libdirectfb-dev</code></pre></div>

<p>Once all of these have installed successfully, you&#39;ll need to download a copy of the source. All downloads can be found here. This guide will assume that you&#39;ll download the .tar.gz source archive.</p>

<h3 id="compilation-and-installation">Compilation and Installation</h3>

<p>Extract the package into a directory under your home directory, somewhere . . .</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>tar -xzf SDL2-*.tar.gz
<span class="nv">$ </span><span class="nb">cd </span>SDL2-*</code></pre></div>

<p>Next we&#39;ll configure, build and install the libraries.</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>./configure
<span class="nv">$ </span>make
<span class="nv">$ </span>sudo make install</code></pre></div>

<p>Once compilation and installation have complete, you&#39;ll need to update your library links/cache. Do this with the following command:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>sudo ldconfig</code></pre></div>

<p>That&#39;s all there is to it. </p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2013/12/31/perlin-noise/">
        Perlin Noise
      </a>
    </h1>

    <span class="post-date">31 Dec 2013</span>

    <h3 id="introduction">Introduction</h3>

<p>Noise functions in computer applications allow programmers to make the machine act a little more naturally. It&#39;s the randomness introduced with these algorithms that gives the computer what appears to be &quot;free thought&quot; or unexpected decisions.</p>

<p>Today, I&#39;ll walk through the <a href="http://en.wikipedia.org/wiki/Perlin_noise">Perlin Noise</a> algorithm which has applications in computer science ranging from player movement, landscape generation, clouds, etc.</p>

<p>Here are some examples of the Perlin Noise function output into two dimensions:</p>

<p><img src="http://3.bp.blogspot.com/-6Bf_wUTyGOM/UsI84BYt7FI/AAAAAAAAAx0/blK32PUte1s/s1600/perlin1.jpg" alt="Noise 1">
<img src="http://4.bp.blogspot.com/-u4wfD21sIvU/UsI85U78XYI/AAAAAAAAAx8/NG2fEzYjTUA/s1600/perlin2.png" alt="Noise 2"></p>

<p>In today&#39;s post, I&#39;ll walk through the Perlin Noise algorithm and what steps you need to take to implement it yourself.</p>

<h3 id="understanding-noise">Understanding Noise</h3>

<p>The Perlin Noise algorithm can be broken down into a few smaller pieces to make it easier to understand. At its heart, the algorithm needs pseudo-random numbers. These random numbers should be repeatable so that you can re-generate the same noise pattern at will.</p>

<p>A common noise function for two parameters that I have found used over the web is as follows:</p>

<div class="highlight"><pre><code class="c"><span class="kt">float</span> <span class="nf">noise</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="mi">57</span><span class="p">;</span>
  <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span><span class="p">)</span> <span class="o">^</span> <span class="n">n</span><span class="p">;</span>
  <span class="k">return</span> <span class="p">(</span><span class="mf">1.0f</span> <span class="o">-</span> <span class="p">(</span> <span class="p">(</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">n</span> <span class="o">*</span> <span class="mi">15731</span> <span class="o">+</span> <span class="mi">789221</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1376312589</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7FFFFFFF</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1073741824.0f</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>

<p>There&#39;s a lot of math transformation in this previous function. You can use any function at all to produce your random numbers, just make sure that you can generate them against two parameters (in the case of 2d) and that you&#39;ll get repeatable results.</p>

<p>Next we&#39;ll smooth out the noise between two points. We&#39;ll do this by sampling the corners, sides and centre of the point we&#39;re currently generating for.</p>

<div class="highlight"><pre><code class="c"><span class="kt">float</span> <span class="nf">smoothNoise</span><span class="p">(</span><span class="k">const</span> <span class="kt">float</span> <span class="n">x</span><span class="p">,</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">ix</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">x</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">iy</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">y</span><span class="p">;</span>

  <span class="c1">// sample the corners</span>
  <span class="kt">float</span> <span class="n">corners</span> <span class="o">=</span> <span class="p">(</span><span class="n">noise</span><span class="p">(</span><span class="n">ix</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">iy</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span>
                   <span class="n">noise</span><span class="p">(</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">iy</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span>
                   <span class="n">noise</span><span class="p">(</span><span class="n">ix</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span>
                   <span class="n">noise</span><span class="p">(</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="mi">16</span><span class="p">;</span>

  <span class="c1">// sample the sides</span>
  <span class="kt">float</span> <span class="n">sides</span> <span class="o">=</span> <span class="p">(</span><span class="n">noise</span><span class="p">(</span><span class="n">ix</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">iy</span><span class="p">)</span> <span class="o">+</span>
                 <span class="n">noise</span><span class="p">(</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">iy</span><span class="p">)</span> <span class="o">+</span>
                 <span class="n">noise</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">iy</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span>
                 <span class="n">noise</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="mi">8</span><span class="p">;</span>

  <span class="c1">// sample the centre</span>
  <span class="kt">float</span> <span class="n">centre</span> <span class="o">=</span> <span class="n">noise</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">);</span>

  <span class="c1">// send out the accumulated result</span>
  <span class="k">return</span> <span class="n">corners</span> <span class="o">+</span> <span class="n">sides</span> <span class="o">+</span> <span class="n">centre</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

<p>With the above function, we can now sample a small area for a given point. All based on our random number generator.</p>

<p>For the fractional parts that occur between solid boundaries, we&#39;ll use a specific interpolation method. I&#39;ve defined two below. One that will do linear interpolation and one that will use cosine for a smoother transition between points.</p>

<div class="highlight"><pre><code class="c"><span class="cm">/* Linear interpolation */</span>
<span class="kt">float</span> <span class="nf">lerp</span><span class="p">(</span><span class="kt">float</span> <span class="n">a</span><span class="p">,</span> <span class="kt">float</span> <span class="n">b</span><span class="p">,</span> <span class="kt">float</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Trigonometric interpolation */</span>
<span class="kt">float</span> <span class="nf">terp</span><span class="p">(</span><span class="kt">float</span> <span class="n">a</span><span class="p">,</span> <span class="kt">float</span> <span class="n">b</span><span class="p">,</span> <span class="kt">float</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">float</span> <span class="n">ft</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mf">3.1415927f</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cosf</span><span class="p">(</span><span class="n">ft</span><span class="p">))</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">f</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">f</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Noise interpolation */</span>
<span class="kt">float</span> <span class="nf">interpolateNoise</span><span class="p">(</span><span class="k">const</span> <span class="kt">float</span> <span class="n">x</span><span class="p">,</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span>   <span class="n">ix</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">x</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">fx</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">ix</span><span class="p">;</span>

  <span class="kt">int</span>   <span class="n">iy</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">y</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">fy</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">iy</span><span class="p">;</span>

  <span class="kt">float</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">smoothNoise</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">),</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="n">smoothNoise</span><span class="p">(</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">iy</span><span class="p">),</span>
        <span class="n">v3</span> <span class="o">=</span> <span class="n">smoothNoise</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">v4</span> <span class="o">=</span> <span class="n">smoothNoise</span><span class="p">(</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

  <span class="kt">float</span> <span class="n">i1</span> <span class="o">=</span> <span class="n">terp</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">fx</span><span class="p">),</span>
        <span class="n">i2</span> <span class="o">=</span> <span class="n">terp</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span> <span class="n">v4</span><span class="p">,</span> <span class="n">fx</span><span class="p">);</span>

  <span class="k">return</span> <span class="n">terp</span><span class="p">(</span><span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">fy</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>

<p>Finally we use this smooth interpolation to perform the perlin noise function. A couple of interesting co-effecients that are provided to the algorithm are &quot;octaves&quot; and &quot;persistence&quot;. &quot;octaves&quot; defines how many iterations that will be performed and &quot;persistence&quot; defines how much of the spectrum we&#39;ll utilise. It&#39;s highly interactive to the main curve co-effecients: frequency and amplitude.</p>

<div class="highlight"><pre><code class="c"><span class="kt">float</span> <span class="nf">perlin2d</span><span class="p">(</span><span class="k">const</span> <span class="kt">float</span> <span class="n">x</span><span class="p">,</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">y</span><span class="p">,</span>
               <span class="k">const</span> <span class="kt">int</span> <span class="n">octaves</span><span class="p">,</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">persistence</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>

  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">octaves</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">float</span> <span class="n">frequency</span> <span class="o">=</span> <span class="n">powf</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">amplitude</span> <span class="o">=</span> <span class="n">powf</span><span class="p">(</span><span class="n">persistence</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>

    <span class="n">total</span> <span class="o">=</span> <span class="n">total</span> <span class="o">+</span> <span class="n">interpolateNoise</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">y</span> <span class="o">*</span> <span class="n">frequency</span><span class="p">)</span> <span class="o">*</span> <span class="n">amplitude</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">total</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

<p>This now provides us with a way to create a map (or 2d array) to produce images much like I&#39;d pasted in above. Here is a typical build loop.</p>

<div class="highlight"><pre><code class="c"><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">w</span><span class="p">;</span> <span class="n">x</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">h</span><span class="p">;</span> <span class="n">y</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">float</span> <span class="n">xx</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">x</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">width</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">yy</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">y</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">height</span><span class="p">;</span>

    <span class="n">map</span><span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="n">w</span><span class="p">)]</span> <span class="o">=</span> <span class="n">perlin</span><span class="o">::</span><span class="n">perlin2d</span><span class="p">(</span>
      <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span>
      <span class="mi">6</span><span class="p">,</span> <span class="mf">1.02f</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>That should be enough to get you going.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2013/12/30/follow-up-to-a-camera-implementation/">
        Follow up to a Camera Implementation
      </a>
    </h1>

    <span class="post-date">30 Dec 2013</span>

    <h3 id="introduction">Introduction</h3>

<p>In a <a href="/2013/12/30/a-camera-implementation-in-c/">previous post</a> I&#39;d written about a simple camera implementation that you can use in projects of your own. This post I&#39;ll show how I&#39;ve implemented this camera with some mouse handling routines to make it feel like you&#39;re orienting your head with the mouse.</p>

<h3 id="the-idea">The Idea</h3>

<p>We&#39;ll capture all of the mouse movements given in an application and see how far the mouse deviates from a given origin point. I think that the most sane origin point to go from is the center of your window. For each movement that the mouse makes from the center of the window, we need to:</p>

<ul>
<li>Determine how much movement occurred on the x axis</li>
<li>Determine how much movement occurred on the y axis</li>
<li>Deaden this movement by a co-efficient to simulate mouse &quot;sensitivity&quot;</li>
<li>Set the yaw and pitch (head up/down, left/right) of the camera</li>
<li>Reset the mouse back to the origin point</li>
</ul>

<p>Here&#39;s how I&#39;ve done it in code:</p>

<div class="highlight"><pre><code class="c"><span class="kt">void</span> <span class="nf">mouseMotion</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// calculate the origin point (shifting right divides by two, remember!)</span>
  <span class="kt">int</span> <span class="n">halfWidth</span> <span class="o">=</span> <span class="n">windowWidth</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">halfHeight</span> <span class="o">=</span> <span class="n">windowHeight</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>

  <span class="c1">// calculate how far we deviated from the origin point and deaden this</span>
  <span class="c1">// by a factor of 20</span>
  <span class="kt">float</span> <span class="n">deltaX</span> <span class="o">=</span> <span class="p">(</span><span class="n">halfWidth</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="mf">20.0f</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">deltaY</span> <span class="o">=</span> <span class="p">(</span><span class="n">halfHeight</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="mf">20.0f</span><span class="p">;</span>

  <span class="c1">// don&#39;t do anything if there wasn&#39;t any movement to report</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">deltaX</span> <span class="o">==</span> <span class="mf">0.0f</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">deltaY</span> <span class="o">==</span> <span class="mf">0.0f</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// set the camera&#39;s orientation</span>
  <span class="n">cam</span><span class="p">.</span><span class="n">yaw</span><span class="p">(</span><span class="n">deltaX</span><span class="p">);</span>
  <span class="n">cam</span><span class="p">.</span><span class="n">pitch</span><span class="p">(</span><span class="n">deltaY</span><span class="p">);</span>

  <span class="c1">// reset the mouse pointer back to the origin point</span>
  <span class="n">glutWarpPointer</span><span class="p">(</span><span class="n">halfWidth</span><span class="p">,</span> <span class="n">halfHeight</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>

<p>You can see that I&#39;m using GLUT to do these demos. The only GLUT-specific piece of code here is the warp command which puts the mouse back onto the origin point. You should have an equivalent function to do the same in the framework of your choice.</p>

<p>Well, there you have it. You can now orient your camera using your mouse.</p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page6">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page4">Newer</a>
    
  
</div>
      </div>
    </div>

  </body>
</html>
