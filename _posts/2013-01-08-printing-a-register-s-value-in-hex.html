---
layout: post
title: Printing a Register's Value in Hex
date: 2013-01-08
comments: false
---

<h1>{{ page.title }}</h1>
<div class='post'>
<h3>Introduction</h3><div>Putting some of the knowledge we've picked up in <a href="http://cogsandlevers.blogspot.com.au/2013/01/assembly-on-osx.html">previous</a> <a href="http://cogsandlevers.blogspot.com.au/2013/01/strlen-implementation-in-nasm.html">posts</a>, todays post is going to be about getting the value that sits in a register out on screen. This post will assume that we're not going to lean on a call like printf, we're going to do it by hand.</div><div><br /></div><h3>How to attack the problem?</h3><div>The solution that I present may immediately strike your eye as verbose &amp; long-winded and this is on purpose. We're going to build something that works to begin with then we can do an analysis of what we've written and optimise it later.</div><div><br /></div><div>I've split the larger problem of printing a register's value (in this case we're printing RAX) into a few smaller problems so as we knock off each problem, we get closer to an overall result. The sub-problems that I have cut this into are:</div><div><ul><li>Printing a nibble (half a byte or 4bit value)</li><li>Printing a byte</li><li>Printing the register value</li></ul><div>So you can see that we're going to implement a solution by solving these smaller issues top to bottom. Let's take a look at some code.</div></div><div><br /></div><h3>Characters and Nibbles</h3><div>We're going to print a nibble. A nibble is 4 bits of data spanning values from 0 up to F hexadecimal or 0 up to 15 in decimal. The plan of attack is to isolate this 4 bits in such a way that we can use it as an offset into a string of characters organised from 0 up to F.&nbsp;</div><div><br /></div><div>Here's the code.</div><div><br /><script src="https://gist.github.com/4483534.js"></script></div><div><br /></div><div><br /></div><div>The code is documented pretty well, and you can see that the crux of the work is just offsetting the base address of the string by the nibble that we want to print. Nifty. Keep in mind that the registers used here are assuming that you're compiling for OSX. If you are compiling for another type of unix make sure that the parameters are being passed through the correct registers, otherwise you'll be segfaulting all the way to the pub!<br /><br /><h3>Stepping up to a byte</h3></div><div>Now we want to chain two "_print_nibble" calls together so that we can print an entire byte out on the screen (0 up to FF). We've already got a procedure that prints the lower 4 bits of al out to the screen, all we really need to do is be creative with al so we can print the higher 4 bits first then the lower 4 bits so that the number comes out to the console in the right order!</div><div><br /></div><div>Here's the code.</div><div><br /><script src="https://gist.github.com/4483628.js"></script></div><div><br /></div><div><br /></div><div>This function holds the same assumption as printing a nibble. There can't be any junk in the higher bits (from al) of rax otherwise this solution will turn to mud.<br /><br /><h3>Going the whole hog!</h3></div><div>We're now able to print any byte we would like, so lets string 8 bytes together to make a 64bit integer that we can print. Again, it's all about shuffling the value that we want to print around correctly so that the number is written to the console in the correct order. It might be confusing to see pushes and pops inside of the loop that I'll present, but I re-use these registers to calculate things on the fly.</div><div><br /></div><div>Again, I've commented this code pretty verbosely so it should read like a bedtime story. Here's the code.</div><div><br /><script src="https://gist.github.com/4483840.js"></script></div><div><br /></div><div><br /></div><div>The key is byte isolation. Using rcx we can count from the top byte down to the bottom with creative shifting.<br /><br />Now that we've implemented all of this code, we can print some boobies to the screen. This is the moment you've been waiting for.<br /><br /><script src="https://gist.github.com/4483880.js"></script> <br />The output of which should just print "B000B135B000B135" to the console. Yes, there's boobies in the article, see!<br /><br />Whilst this may not appear to be the most useful function right now, it'll serve as a very useful debugging tool for us in the future.<br /><br /><br /></div></div>
<h2>Comments</h2>
<div class='comments'>
</div>
