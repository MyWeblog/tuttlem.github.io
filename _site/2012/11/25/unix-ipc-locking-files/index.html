<p>Locking a file helps assure your program that no other processes can tamper with it or a region of it.</p>

<p>This snippet will show you how to lock and unlock a file.struct flock fl;
int fd;</p>

<div class="highlight"><pre><code class="c"><span class="cm">/* fill out the lock structure */</span>   
<span class="n">fl</span><span class="p">.</span><span class="n">l_type</span>   <span class="o">=</span> <span class="n">F_WRLCK</span><span class="p">;</span> 
<span class="n">fl</span><span class="p">.</span><span class="n">l_whence</span> <span class="o">=</span> <span class="n">SEEK_SET</span><span class="p">;</span>
<span class="n">fl</span><span class="p">.</span><span class="n">l_start</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>       
<span class="n">fl</span><span class="p">.</span><span class="n">l_len</span>    <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>       
<span class="n">fl</span><span class="p">.</span><span class="n">l_pid</span>    <span class="o">=</span> <span class="n">getpid</span><span class="p">();</span>
 
<span class="cm">/* open the file */</span>
<span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">&quot;filename&quot;</span><span class="p">,</span> <span class="n">O_WRONLY</span><span class="p">);</span>
 
<span class="cm">/* lock the file */</span>
<span class="n">fcntl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">F_SETLKW</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fl</span><span class="p">);</span>
 
<span class="cm">/* --- complete any work here with the file locked --- */</span>
 
<span class="cm">/* unlock the file now */</span>
<span class="n">fl</span><span class="p">.</span><span class="n">l_type</span>   <span class="o">=</span> <span class="n">F_UNLCK</span><span class="p">;</span> 
<span class="n">fcntl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">F_SETLK</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fl</span><span class="p">);</span></code></pre></div>

<h3 id="further-reading">Further reading</h3>

<p><a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?fcntl">The fcntl system call</a></p>
