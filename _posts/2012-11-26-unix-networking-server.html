---
layout: post
title: Unix Networking: Server
date: 2012-11-26
comments: false
---

<h1>{{ page.title }}</h1>
<div class='post'>
The following snippet is a bare-bones server.<br /><br /><pre class="brush:c;">int sockfd, new_fd;  <br />struct addrinfo hints, *servinfo, *p;<br />struct sockaddr_storage their_addr; <br />socklen_t sin_size;<br />struct sigaction sa;<br />int yes=1;<br />char s[INET6_ADDRSTRLEN];<br />int rv;<br /><br />/* fill out the address structure */<br />memset(&amp;hints, 0, sizeof hints);<br />hints.ai_family = AF_UNSPEC;<br />hints.ai_socktype = SOCK_STREAM;<br />hints.ai_flags = AI_PASSIVE; <br /><br />/* get the address information */<br />getaddrinfo(NULL, PORT, &amp;hints, &amp;servinfo);<br /><br />/* open the socket */<br />sockfd = socket(p-&gt;ai_family, p-&gt;ai_socktype, p-&gt;ai_protocol);<br /><br />/* allow the socket to be re-used */<br />setsockopt(sockfd, SOL_SOCKET, SO_REUSEADDR, &amp;yes, sizeof(int));<br /><br />/* bind the socket to the address */<br />bind(sockfd, p-&gt;ai_addr, p-&gt;ai_addrlen);<br /><br />/* free up the address structure */<br />freeaddrinfo(servinfo); <br /><br />/* start the socket listening */<br />listen(sockfd, BACKLOG);<br /><br />/* accept the first connect */<br />new_fd = accept(sockfd, (struct sockaddr *)&amp;their_addr, &amp;sin_size);<br /><br />/* send the client some data */<br />send(new_fd, "Hello, world!", 13, 0);<br /> <br />/* finished with the client &amp; server */<br />close(new_fd);<br />close(sockfd);<br /></pre><br /><br />Further reading<br /><br /><a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?getaddrinfo+3">The getaddrinfo system call</a><br /><a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?socket">The socket system call</a><br /><a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?bind+2">The bind system call</a><br /><a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?listen+2">The listen system call</a><br /><a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?accept+2">The accept system call</a><br /><a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?recv">The recv system call</a><br /><a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?send">The send system call</a></div>
<h2>Comments</h2>
<div class='comments'>
</div>
