<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Cogs and Levers &middot; A blog full of technical stuff
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>A place for thoughts, ideas, tutorials and bookmarks. My brain can only hold so much, you know.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    

    <a class="sidebar-nav-item" href="https://github.com/tuttlem/tuttlem.github.io">GitHub</a>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2014. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <label for="sidebar-checkbox" class="sidebar-toggle"></label>

          <h3 class="masthead-title">
            <a href="/" title="Home">Cogs and Levers</a>
            <small>A blog full of technical stuff</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2013/01/14/glfw-b-from-haskell/">
        GLFW-b from Haskell
      </a>
    </h1>

    <span class="post-date">14 Jan 2013</span>

    <h1>GLFW-b from Haskell</h1>
<div class='post'>
<h3>Introduction</h3><div>I've previously posted about getting up and running with OpenGL from Haskell <a href="http://cogsandlevers.blogspot.com.au/2013/01/opengl-glut-haskell.html">here</a>, but I've since learned of <a href="http://www.glfw.org/">GLFW</a>&nbsp;and some of its bindings into Haskell in the form of <a href="http://hackage.haskell.org/package/GLFW">glfw</a>&nbsp;and <a href="http://hackage.haskell.org/package/GLFW-b">glfw-b</a>. The posts that I have been reading seem to present glfw-b with a more Haskell-style interface so this is the binding choice that I've decided to go with.</div><div><br /></div><div>Today, I'll walk you through a very simple application that will present you with a 2D drawing surface ready to go. It will demonstrate how to respond to window resize events, key input, GL setup and teardown.</div><div><br /></div><div>There is some great resources around for these bindings. The <a href="http://www.haskell.org/haskellwiki/GLFW">Haskell Wiki</a> has an article on GLFW with a link to some GLFW-b ports of the <a href="http://nehe.gamedev.net/">nehe tutorials</a> <a href="http://hackage.haskell.org/package/nehe-tuts">here</a>.</div><div><br /></div><div>The code for this is available in my <a href="https://github.com/tuttlem/haskets">haskets</a> repository. Here's the <a href="https://raw.github.com/tuttlem/haskets/master/glfw/First.hs">direct link</a> to the file we'll be analysing.&nbsp;</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-aPw7-CRRMjw/UPPCxR9z0dI/AAAAAAAAAk4/J2ZUX2_6jHc/s1600/Screen+Shot+2013-01-14+at+6.32.45+PM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="326" src="http://1.bp.blogspot.com/-aPw7-CRRMjw/UPPCxR9z0dI/AAAAAAAAAk4/J2ZUX2_6jHc/s400/Screen+Shot+2013-01-14+at+6.32.45+PM.png" width="400" /></a></div><div><br /></div><h3>The code</h3><div>First off, we'll take a look at what's being imported into this application.</div><div><br /><script src="https://gist.github.com/4528618.js"></script></div><div><br />The GLFW bindings come into the program on the first line. This really is the bridge between OpenGL and your presentation layer to get a window running and some sort of eventing communication being routed into your program.<br /><br />OpenGL and GLU raw are just as they say. You'll see code in this tutorial that looks directly from these APIs. The names aren't lying.<br /><br />Finally here we just have some program management handling exit codes and execution life.<br /><br />After we've imported everything that we need, it's time to setup the GL scene as if all of the window management stuff has already been done.<br /><br /><script src="https://gist.github.com/4529208.js"></script> These are all looking like very natural GL calls. The code commentary should guide you through what's happening here.<br /><br />When the window that's hosting our application changes dimensions, our program will be sent a message updating us on what the new dimensions are. Here's how we adapt to these changes in 2D.<br /><br /><script src="https://gist.github.com/4529230.js"></script> These are all standard OpenGL calls also. The signature of the resize function delivers us the updated width and height to use.<br /><br />Drawing our scene is extremely basic. We're clearing the screen (to black, as above). That's it.<br /><script src="https://gist.github.com/4529240.js"></script> <br /><br />'nuff said. To destroy all of the resources we've utilised in the target windowing system we issue some teardown functions.<br /><br /><script src="https://gist.github.com/4529256.js"></script> <br />Handling keyboard input is just a matter of using KeyCallback.<br /><br />The teardown handler is entered when the escape key is hit. Any other key is ignored.<br /><script src="https://gist.github.com/4529268.js"></script> All of these function definitions are really no good to us unless we can bind them into the framework. This will bring all of these functions to life. The next block of code is the main program for the application. It'll be heavily commented.<br /><br /><script src="https://gist.github.com/4529317.js"></script> So, that's it for GLFW-b for Haskell. Not so intimidating and actually quite inviting to develop against!</div></div>
<h2>Comments</h2>
<div class='comments'>
</div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2013/01/12/writing-a-window-manager-for-x11/">
        Writing a Window Manager for X11
      </a>
    </h1>

    <span class="post-date">12 Jan 2013</span>

    <h1>Writing a Window Manager for X11</h1>
<div class='post'>
As a bit of a bookmark to myself, I just wanted to post about writing a window manager for X windows. A lot of the material that I've seen around the place in articles and posts themselves have all pointed me towards downloading the out-of-print <a href="http://oreilly.com/openbook/">O'Reilly Open Book</a> site.<br /><br />Some of the books of interest to a window manager programmer are<br /><ul><li><a href="http://www.archive.org/details/xlibretmanver1102nyemiss">Xlib Reference Manual</a></li><li><a href="http://www.archive.org/details/xlibrefmanv115ed02nyemiss">Xlib Reference Manual Volume 2</a></li><li><a href="http://www.archive.org/details/xtoolkitintrinsi04nyemiss">X Toolkit Intrinsics Programming Manual</a></li><li><a href="http://www.archive.org/details/xtoolkitintrirefman05oreimiss">X Toolkit Intrinsics Reference Manual</a></li></ul><div>I'm sure that there is plenty of other reference material around, but a lot of people were suggesting to put a copy of these in your claw - so I have.</div><div><br /></div><div>Digging around a little bit more, I came across <a href="http://incise.org/tinywm.html">TinyWM</a>.&nbsp;<a href="http://incise.org/tinywm.html">TinyWM</a>&nbsp;looks like a suitable candidate to be the bootstrap to a window manager project. It's functional, it doesn't do much but it is around 50 lines of C code. I'll be using this as my guide for when that rainy day comes and I start work on my own WM.</div><div><br /></div><div><br /></div></div>
<h2>Comments</h2>
<div class='comments'>
</div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2013/01/12/clojure-s-spine-java/">
        Clojure S Spine Java
      </a>
    </h1>

    <span class="post-date">12 Jan 2013</span>

    <h1>Clojure S Spine Java</h1>
<div class='post'>
<h3>Introduction</h3><div>One of Clojure's greatest strengths is the fact that it sits on the JVM. This puts all of those jars that people have worked tirelessly over the years to produce right at your fingertips ready for use in your Clojure code.</div><div><br /></div><div>Today's post will just be a short tutorial on some of the most basic routines to use Java classes in your Clojure code. All of the examples that I'll produce are all based on the <a href="http://clojure.org/java_interop">Java_interop page</a> on the Clojure site.</div><div><br /></div><h3>Importing classes</h3><div>First things first. You'll need to import the classes that you want to use. You don't have to, it just makes your code a little less verbose later on.</div><div><br /><script src="https://gist.github.com/4515624.js"></script></div><div>We're now able to use the URL class in our code.<br /><br />If you're importing classes into your programs that aren't local and need to be downloaded as a dependency, I suggest you use <a href="http://leiningen.org/">Leiningen</a>&nbsp;to do all the heavy lifting for you there. You'd just need to list your external package in the dependencies list in your project file and away you go.<br /><br /><h3>Using the classes</h3></div><div>We need to construct some objects so that we'll be able to call methods on them, so following on from the example, we construct instances of the classes that we import like so.</div><div><br /><script src="https://gist.github.com/4515648.js"></script></div><div><br /></div><div>This is really getting the Java mojo mixed in with Clojure now. So "google" is our constructed object, we can start to call methods on this variable like so.<br /><br /><script src="https://gist.github.com/4515663.js"></script></div><div>We were able to find out the protocol of the URL using <a href="http://docs.oracle.com/javase/6/docs/api/java/net/URL.html#getProtocol()">getProtocol</a>&nbsp;and we were able to compare "google" and "yahoo" using <a href="http://docs.oracle.com/javase/6/docs/api/java/net/URL.html#sameFile(java.net.URL)">sameFile</a>.<br /><br /><h3>doto</h3></div><div>The last thing I want to talk about is <a href="http://clojuredocs.org/clojure_core/1.2.0/clojure.core/doto">doto</a>. doto evaluates its first parameter than allows you to chain a series of calls (just as you would in Java using the "." operator) together. Here's a an example using a <a href="http://docs.oracle.com/javase/6/docs/api/java/util/HashMap.html">HashMap</a> class and chaining a few put's together. This statement will return the built <a href="http://docs.oracle.com/javase/6/docs/api/java/util/HashMap.html">HashMap</a>.</div><div><br /><script src="https://gist.github.com/4515694.js"></script></div><div><br /></div><div>Well, that's it for today. I'm off to write some Java .. I mean, Clojure, I mean ... you know what I mean.</div></div>
<h2>Comments</h2>
<div class='comments'>
</div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2013/01/11/tic-tac-toe-in-haskell/">
        Tic Tac Toe in Haskell
      </a>
    </h1>

    <span class="post-date">11 Jan 2013</span>

    <h1>Tic Tac Toe in Haskell</h1>
<div class='post'>
<h3>Introduction</h3><div>Still trying to flex my skills in the Haskell arena and am still chasing a real project to do. Until I find said project, silly little games it is. A little while ago I watched the Haskell Live videos and in these videos&nbsp;a good start is made on a chess framework. Very interesting stuff to see how something like this is put together and if you haven't seen them, I suggest you go and check out <a href="http://www.youtube.com/watch?v=ScS8Q32lMxA">episode 1</a>&nbsp;and <a href="http://www.youtube.com/watch?v=6KkF5-_erns">episode 2</a>.</div><div><br /></div><div>Anyway, the videos don't yet take you through to a completed implementation and while I'd love to say that I possess the skills to take the chess game through, I'd be punching above my weight. In compromise, I've been able to use some of the concepts that Rein has demonstrated in his videos - in my own implementation of Tic Tac Toe.</div><div><br /></div><div>Today's post will take you through my implementation. The full source for this program can be found in my <a href="https://github.com/tuttlem/haskets/">haskets</a> git repository. The specific file is <a href="https://raw.github.com/tuttlem/haskets/master/TicTacToe.hs">here</a>.</div><div><br /></div><h3>Functional Specification</h3>Well, if you're really wanting the functional in's-and-out's of the game Tic-tac-toe, I suggest you step our of your bubble and read <a href="http://en.wikipedia.org/wiki/Tic-tac-toe">this</a>. This implementation will involve two rather random computer players battling it out, so no user interactivity (yet).<br /><br />Well, thanks to a cheeky link to a wikipedia article, that's the smallest functional specification I've ever seen. On to the code.<br /><br /><h3>Pieces</h3><div>First up, we'll deal with pieces. To this program, a piece can be a Naught or a Cross. When the piece is a Naught, we want to represent it with a 'o', when the piece is a Cross, we want to represent it with an 'x'. Here's the type declaration and functions we'll use to work with pieces.</div><div><br /><script src="https://gist.github.com/4508753.js"></script></div><div><br />A piece can only be either a Naught or a Cross, nothing else. The functions are all very straight forward and meeting the requirements of our specification. Naughts will look like "o's" and Crosses will look like "x's". Just to be sure, we can setup a couple of QuickCheck tests to assure us that it's ok.<br /><br /><script src="https://gist.github.com/4508767.js"></script> We're ready to move on.<br /><br /><h3>Cells</h3></div><div>A cell is a representation of one of the nine squares that you find on a tic-tac-toe board. A cell differs from a piece as a cell can have a piece value or it can be empty. In our implementation, empty cells will be represented by a period ".". Let's take a look at the types and the functions we'll use to interact with cells.</div><div><br /><script src="https://gist.github.com/4508784.js"></script></div><div><br /></div><div>We use Maybe to allow either a Nothing or a Piece value for a cell. With the help of those functions we've already written for pieces, you can see that these cell functions are very simple. We've only had to cater for one extra case, the case of when there's no value in a cell. We'll setup a few more QuickCheck tests just to make sure that our Cell code is working ok.<br /><br /><script src="https://gist.github.com/4508796.js"></script> <br />Great. With this code written we're ready to wrap up a List of these cells into a field that we will play on.<br /><br /><h3>The Field</h3></div><div>A 3x3 grid is normally what's drawn prior to playing a game of tic-tac-toe. We will define the field as an array of an array of cells. Here's the type and supporting functions for a field.</div><div><br /><script src="https://gist.github.com/4508896.js"></script></div><div><br /></div><div>Much as before, you can see that we're leaning on our already-built set of functions to implement all of our field-based functions. At this point, we can define the starting field that all of our games will originate with.<br /><br /><script src="https://gist.github.com/4508910.js"></script> <br />You can see that the field is in string format. It's a little more human to read and it's all ready for our "readField" function to use as is demonstrated by the following QuickCheck test.<br /><br /><script src="https://gist.github.com/4509074.js"></script> <br />It's at this point where any similarities between the Haskell Live videos and my implementation end. It's probably natural that this is the point as we're going to start dealing with some game logic.<br /><br /><h3>Winners and Losers</h3></div><div>There are a few tests that we have to be constantly running in order to simulate a real-life game of tic-tac-toe. One of which is "do we have a winner yet?<br /><br /></div><div><div>Testing if a winner has been established is testing if the same symbol appears on a horizontal, vertical or diagonal line. In each of these configurations, there are only going to be three cells to test, so I made a general purpose array tester. I've use pattern matching in this function to be as clear as possible. It's not as DRY as it could be, but we can improve it later - let's just get it working.</div></div><div><br /></div><div>Here's the function to test three list elements to see if there's a winner.</div><div><br /><script src="https://gist.github.com/4509099.js"></script></div><div>Easy. This function looks like it will be very effective in testing winners on the horizontal lines. But what about the vertical lines that occur in different arrays? and the diagonal lines that exist in different arrays and in different indexes across the horizontal axis?<br /><br />My answer here is to create a function that make all of these testable vectors into horizontal rows so that we can use the above function on all of the different win configurations. Here's the code to build an array of these 3 element arrays.<br /><br /><script src="https://gist.github.com/4509135.js"></script> Walking through this one piece-by-piece, we can see a number of items in the where clause. Sure, these could be consolidated into a big-fat-one-liner, but I wanted to make clear exactly what was being concatenated. So, "horiz" is a list comprehension giving you each horizontal line, "col1", "col2" and "col3" are the vertical columns. "diag" is a little less clearer through its use of head and drop, but it does form the diagonals into testable rows.<br /><br /><h3>Playing the game</h3></div><div>Weather you're a computer or human player, you'll need to know where are the valid spots to move. It'll be intuitive enough from the user interface presented for a human to realise where their next move will be, but our computer player counterparts will need to be told explicitly where they can move. This next function just finds all of the available cells that you can move into.</div><div><br /><script src="https://gist.github.com/4509556.js"></script></div><div><br /></div><div>We assign an index (from 0 to 8) to each cell and only return the indexes that are paired with a "Nothing" value. This function will help us later when we go to build a user interface for this application. We'll be able to prompt the user intuitively.&nbsp;</div><div><br />Flattening the array gives us the [0..8] range, which over the 3x3 grid (which is really our tic-tac-toe representation), the range looks like this.<br /><br /><pre>0 1 2<br />3 4 5<br />6 7 8</pre><br />This is timely information as we're just about to present the function that will place a piece on the field for us. Placing a piece will require us to provide the current game field, the piece we want to apply and the index that we want to apply it at. This function cuts the list on the index that we want to apply and then re-concatenates the broken list around the new piece (obviously dropping the cell that we're putting a piece into). Here's the code.<br /><br /><script src="https://gist.github.com/4509592.js"></script> <br />Trying to be as clear as possible with my names here. "prior" being the list before the break, "after" is what comes after.<br /><br />Now it's time to introduce our "artificial intelligence" which really - there isn't any intelligence here. It's based purely off of a random number generator. Here's how our computer players will play a round of tic-tac-toe.<br /><br /><script src="https://gist.github.com/4509606.js"></script> <br />We're taking in a random number generator, the piece type that the computer will place and the field that it will be placed in. The output to which will be a new random number generator and the changed field. This way, we can repeatedly call this function and not worry about losing our sense of entropy (or field state!).<br /><br />Finally we have the function that will play our game until we have a result (win naught, win cross or tie). I needed to implement a "not" function for my piece type. This is just so I can offer each "player" a go interchangeably. Here's the code.<br /><br /><script src="https://gist.github.com/4509651.js"></script> <br />This reads fairly humanly. We assume that if execution breaks into this function, a result wasn't established on the execution prior, so we're comfortable in the first check that if there are no spaces left to put pieces, we must declare the game as a tie. The next test is if the previous call to this function caused the other player to win the game. In the event that this check is confirmed, a message is written out and we do not continue any further. If there still isn't a winner, we get this player to place a piece into a cell and then recurse on this function as the other player.<br /><br />Here is how a game runs when using 1 into mkStdGen.<br /><br /><pre>*TicTacToe&gt; let f = readField initialField<br />*TicTacToe&gt; playGame (mkStdGen 1) Cross f<br />...<br />...<br />...<br /><br />..x<br />...<br />...<br /><br />o.x<br />...<br />...<br /><br />o.x<br />...<br />..x<br /><br />o.x<br />...<br />.ox<br /><br />oxx<br />...<br />.ox<br /><br />oxx<br />.o.<br />.ox<br /><br />oxx<br />.o.<br />xox<br /><br />oxx<br />.oo<br />xox<br /><br />Game was a tie!<br /></pre><br />That's tic-tac-toe.<br /><br />Next time I'll add some user interactivity so that the computer doesn't have all the fun!</div></div>
<h2>Comments</h2>
<div class='comments'>
</div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2013/01/11/mongodb-console-cheatsheet/">
        MongoDB console cheatsheet
      </a>
    </h1>

    <span class="post-date">11 Jan 2013</span>

    <h1>MongoDB console cheatsheet</h1>
<div class='post'>
<h3>Basic retrieves</h3><div>Find all items in a collection</div><div><pre class="brush:js">db.collection.find();</pre><br /><div>Count all items in a collection</div><div><pre class="brush:js">db.collection.count();</pre><br /></div><div>Find all items in a collection with criteria (Mongo <a href="http://docs.mongodb.org/manual/reference/operators/">operators</a> reference)</div><div><pre class="brush:js">db.collection.find({"field": value});</pre></div><div><br /></div><div>Reduce the field-set returned by a query</div><div><div><pre class="brush:js">db.collection.find({}, {"field": 1});</pre></div></div><div><br /></div><div><div>Sorting by a field</div><div><pre class="brush:js">db.collection.find().sort({"field": 1});</pre></div><div><br /></div></div><div>Limit the number of records returned by a query</div><div><pre class="brush:js">db.collection.find().limit(3);</pre></div><div><br /></div><div><div>Skip over a set of documents</div><div><pre class="brush:js">db.collection.find().skip(3);</pre><h3>List processing</h3></div></div><div><div>Map over a cursor of results</div><div><pre class="brush:js">db.collection.find().map(function(item) {<br />     return item;<br />});</pre></div></div><div><br /></div><div>Iterate over a cursor of results</div><div><div><pre class="brush:js">db.collection.find().forEach(function(item) {<br />     printjson(item);<br />});</pre></div></div><div><br /></div><h3>Updates</h3><div>Update over an enumerated list</div><div><pre class="brush:js">db.collection.find().forEach(function(item) {<br />     // make changes to item<br />     db.collection.save(item);<br />});</pre></div><div><br />Update from a query (Mongo <a href="http://docs.mongodb.org/manual/applications/update/">update</a> reference)<br /><div><pre class="brush:js">db.collection.update({"_id": ObjectId("xxxx")}, <br />                     { $set: { "field": value },<br />                       $push: { "subdocument": subdocument } });</pre></div><div></div></div><h3>&nbsp;Deleting</h3><div>Destroy an entire collection</div><div><pre class="brush:js">db.collection.drop();</pre><br /><div>Delete a document selectively</div><pre class="brush:js">db.collection.remove({"_id": ObjectId("xxxx"));</pre><br /><h3>Utilities</h3></div></div><div>Set the record limit returned to the console</div><div><pre class="brush:js">DBQuery.shellBatchSize = 100</pre></div></div>
<h2>Comments</h2>
<div class='comments'>
</div>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page21">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page19">Newer</a>
    
  
</div>
      </div>
    </div>

  </body>
</html>
